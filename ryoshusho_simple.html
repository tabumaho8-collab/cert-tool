<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚·ãƒ³ãƒ—ãƒ«é ˜åæ›¸ä½œæˆ</title>
    <style>
        /* --- å…¨ä½“ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        body {
            display: none; /* ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç”¨ */
            font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
            gap: 20px;
            justify-content: center;
            min-height: 100vh;
        }

        /* --- å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  --- */
        .editor-pane {
            width: 350px;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            height: fit-content;
        }

        /* æˆ»ã‚‹ãƒœã‚¿ãƒ³ */
        .back-btn {
            display: inline-block;
            background-color: #6c757d;
            color: white;
            padding: 5px 10px;
            text-decoration: none;
            border-radius: 4px;
            font-size: 12px;
            margin-bottom: 15px;
            cursor: pointer;
        }
        .back-btn:hover { background-color: #5a6268; }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 12px; font-weight: bold; margin-bottom: 5px; color: #555; }
        .form-group input, .form-group textarea {
            width: 100%; padding: 10px; box-sizing: border-box;
            border: 1px solid #ccc; border-radius: 4px; font-size: 14px;
        }
        /* é‡‘é¡å…¥åŠ›æ¬„ã‚’ç›®ç«‹ãŸã›ã‚‹ */
        .input-money { font-size: 16px; font-weight: bold; text-align: right; }

        button.print-btn {
            width: 100%; padding: 12px; background-color: #333;
            color: white; border: none; border-radius: 4px; font-size: 16px;
            cursor: pointer; font-weight: bold; margin-top: 20px;
        }
        button.print-btn:hover { background-color: #000; }

        /* --- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ --- */
        .preview-pane { flex-grow: 1; display: flex; justify-content: center; }

        #receipt {
            width: 210mm; min-height: 297mm; background: white; padding: 25mm;
            box-sizing: border-box; box-shadow: 0 5px 15px rgba(0,0,0,0.2); position: relative;
            color: #000;
        }

        /* --- é ˜åæ›¸ã®ä¸­èº«ï¼ˆç”»åƒã®ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’å†ç¾ï¼‰ --- */
        .r-title {
            text-align: center; font-size: 28px; font-weight: bold;
            margin-bottom: 60px; letter-spacing: 5px;
        }

        .r-header {
            display: flex; justify-content: space-between; align-items: flex-end;
            margin-bottom: 40px;
        }
        .r-client { font-size: 24px; border-bottom: 1px solid #000; padding-bottom: 5px; min-width: 300px; }
        .r-date { font-size: 14px; text-align: right; }

        .r-amount-row {
            display: flex; justify-content: space-between; align-items: flex-end;
            border-bottom: 2px solid #000;
            padding-bottom: 10px; margin-bottom: 20px;
        }
        .r-amount-label { font-size: 18px; font-weight: bold; }
        .r-total-amount { font-size: 36px; font-weight: bold; }

        .r-proviso { font-size: 14px; margin-bottom: 80px; }

        /* ä¸‹éƒ¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆå·¦ï¼šå†…è¨³ã€å³ï¼šä¼šç¤¾æƒ…å ±ï¼‰ */
        .r-footer {
            display: flex; justify-content: space-between; align-items: flex-end;
        }

        /* å†…è¨³ã‚¨ãƒªã‚¢ */
        .tax-breakdown { font-size: 12px; line-height: 1.8; }
        .tax-title { font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        .tax-row { display: flex; justify-content: space-between; width: 220px; }

        /* ä¼šç¤¾æƒ…å ±ã‚¨ãƒªã‚¢ */
        .issuer-info { text-align: right; font-size: 14px; line-height: 1.6; }
        .issuer-name { font-size: 18px; font-weight: bold; margin-bottom: 5px; }

        /* --- å°åˆ·è¨­å®š --- */
        @media print {
            body { display: block !important; background: none; margin: 0; padding: 0; }
            .editor-pane { display: none; }
            .preview-pane { display: block; }
            #receipt { box-shadow: none; width: 100%; height: 100%; margin: 0; padding: 25mm; page-break-after: always; }
            @page { margin: 0; size: A4 portrait; }
        }
        @media (max-width: 900px) {
            body { flex-direction: column; align-items: center; }
            .editor-pane { width: 100%; max-width: 500px; }
            #receipt { width: 100%; font-size: 0.8em; padding: 10mm; }
        }
    </style>
</head>
<body>

    <!-- å…±é€šè¨­å®šèª­ã¿è¾¼ã¿ -->
    <script src="auth.js"></script>
    <script src="settings.js"></script>
    <script>
        if (typeof checkAuth === 'function') checkAuth(); else document.body.style.display = "flex";
        window.addEventListener('load', function() {
            if (typeof applyCompanyData === 'function') applyCompanyData();
            // åˆæœŸæ—¥ä»˜
            document.getElementById('iptDate').valueAsDate = new Date();
            update();
        });
    </script>

    <!-- å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="editor-pane">
        <a href="index.html" class="back-btn">â¬… ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</a>
        
        <h2>ã‚·ãƒ³ãƒ—ãƒ«é ˜åæ›¸</h2>
        
        <div class="form-group">
            <label>å®›å</label>
            <input type="text" id="iptClient" placeholder="ã€‡ã€‡æ ªå¼ä¼šç¤¾ å¾¡ä¸­" oninput="update()">
        </div>
        <div class="form-group">
            <label>é ˜åæ—¥</label>
            <input type="date" id="iptDate" oninput="update()">
        </div>

        <hr>
        
        <div style="background:#f9f9f9; padding:10px; border-radius:4px; margin-bottom:15px;">
            <label style="font-weight:bold; margin-bottom:10px; display:block;">é‡‘é¡å…¥åŠ› (ç¨è¾¼)</label>
            
            <div class="form-group">
                <label>10%å¯¾è±¡ é‡‘é¡</label>
                <input type="number" id="iptAmount10" class="input-money" placeholder="0" oninput="update()">
            </div>
            <div class="form-group">
                <label>8%å¯¾è±¡ é‡‘é¡ (è»½æ¸›ç¨ç‡)</label>
                <input type="number" id="iptAmount8" class="input-money" placeholder="0" oninput="update()">
            </div>
            <p style="font-size:11px; color:#666; margin:0;">â€»ã“ã“ã«å…¥åŠ›ã™ã‚‹ã¨æ¶ˆè²»ç¨é¡ã¯è‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã™ã€‚</p>
        </div>

        <div class="form-group">
            <label>ä½†ã—æ›¸ã</label>
            <input type="text" id="iptProviso" placeholder="ãŠå“ä»£ã¨ã—ã¦" oninput="update()">
        </div>

        <hr>

        <h3>ç™ºè¡Œè€…æƒ…å ±</h3>
        <div class="form-group">
            <label>ä¼šç¤¾å</label>
            <input type="text" id="iptIssuerName" placeholder="æ ªå¼ä¼šç¤¾ã€‡ã€‡" oninput="update()">
        </div>
        <div class="form-group">
            <label>ä½æ‰€</label>
            <textarea id="iptIssuerAddr" rows="2" placeholder="æ±äº¬éƒ½æ¸‹è°·åŒº..." oninput="update()"></textarea>
        </div>
        <div class="form-group">
            <label>ç™»éŒ²ç•ªå·</label>
            <input type="text" id="iptRegNo" placeholder="T12345..." oninput="update()">
        </div>

        <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ å°åˆ·ã™ã‚‹</button>
    </div>

    <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
    <div class="preview-pane">
        <div id="receipt">
            
            <div class="r-title">é ˜åæ›¸</div>

            <div class="r-header">
                <div class="r-client" id="viewClient"></div>
                <div class="r-date">
                    é ˜åæ—¥ã€€<span id="viewDate"></span>
                </div>
            </div>

            <div class="r-amount-row">
                <div class="r-amount-label">åˆè¨ˆé‡‘é¡</div>
                <div class="r-total-amount">Â¥<span id="viewTotal">0</span></div>
            </div>

            <div class="r-proviso">
                ä½†ã—<br>
                <span id="viewProviso"></span><br>
                ä¸Šè¨˜ã®é€šã‚Šã€æ­£ã«é ˜åã„ãŸã—ã¾ã—ãŸã€‚
            </div>

            <div class="r-footer">
                <!-- å·¦ä¸‹ï¼šå†…è¨³ -->
                <div class="tax-breakdown">
                    <div class="tax-title">å†…è¨³</div>
                    
                    <div class="tax-row">
                        <span>10%ç¨ç‡å¯¾è±¡ å°è¨ˆ</span>
                        <span>Â¥<span id="viewSub10">0</span></span>
                    </div>
                    <div class="tax-row">
                        <span>8%ç¨ç‡å¯¾è±¡ å°è¨ˆ</span>
                        <span>Â¥<span id="viewSub8">0</span></span>
                    </div>
                    <div class="tax-row">
                        <span>10%å¯¾è±¡ ç¨é¡</span>
                        <span>Â¥<span id="viewTax10">0</span></span>
                    </div>
                    <div class="tax-row">
                        <span>8%å¯¾è±¡ ç¨é¡</span>
                        <span>Â¥<span id="viewTax8">0</span></span>
                    </div>
                </div>

                <!-- å³ä¸‹ï¼šç™ºè¡Œè€…æƒ…å ± -->
                <div class="issuer-info">
                    <div class="issuer-name" id="viewIssuerName"></div>
                    <div id="viewIssuerAddr" style="white-space: pre-wrap;"></div>
                    <div>ç™»éŒ²ç•ªå· <span id="viewRegNo"></span></div>
                    <!-- ãƒãƒ³ã‚³ã‚¹ãƒšãƒ¼ã‚¹ -->
                    <div style="margin-top:20px; color:#ccc; border:1px solid #eee; width:60px; height:60px; display:flex; align-items:center; justify-content:center; margin-left:auto;">(å°)</div>
                </div>
            </div>

        </div>
    </div>

    <script>
        function fmt(num) { return num.toLocaleString(); }
        function formatDate(dateStr) {
            if(!dateStr) return "";
            const d = new Date(dateStr);
            return `${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()}`;
        }

        function update() {
            // åŸºæœ¬æƒ…å ±ã®åæ˜ 
            document.getElementById('viewClient').innerText = document.getElementById('iptClient').value;
            document.getElementById('viewDate').innerText = formatDate(document.getElementById('iptDate').value);
            document.getElementById('viewProviso').innerText = document.getElementById('iptProviso').value;
            
            document.getElementById('viewIssuerName').innerText = document.getElementById('iptIssuerName').value;
            document.getElementById('viewIssuerAddr').innerText = document.getElementById('iptIssuerAddr').value;
            document.getElementById('viewRegNo').innerText = document.getElementById('iptRegNo').value;

            // é‡‘é¡è¨ˆç®—
            // å…¥åŠ›ã•ã‚ŒãŸã®ã¯ã€Œç¨è¾¼é‡‘é¡ã€
            const in10 = parseInt(document.getElementById('iptAmount10').value) || 0;
            const in8  = parseInt(document.getElementById('iptAmount8').value) || 0;

            // åˆè¨ˆ
            const total = in10 + in8;
            document.getElementById('viewTotal').innerText = fmt(total);

            // ã‚¤ãƒ³ãƒœã‚¤ã‚¹è¨ˆç®—ï¼ˆå‰²ã‚Šæˆ»ã—è¨ˆç®—ï¼‰
            // 10%å¯¾è±¡
            const sub10 = Math.floor(in10 / 1.1); // ç¨æŠœé‡‘é¡
            const tax10 = in10 - sub10;           // æ¶ˆè²»ç¨é¡
            
            // 8%å¯¾è±¡
            const sub8 = Math.floor(in8 / 1.08);  // ç¨æŠœé‡‘é¡
            const tax8 = in8 - sub8;              // æ¶ˆè²»ç¨é¡

            // å†…è¨³è¡¨ç¤ºï¼ˆâ€»ç”»åƒã«åˆã‚ã›ã¦ã€Œç¨è¾¼ã€ã§ã¯ãªãã€Œç¨æŠœ(å°è¨ˆ)ã€ã‚’è¡¨ç¤ºã™ã‚‹å ´åˆãŒå¤šã„ã§ã™ãŒã€
            // ç”»åƒã®ã€Œå°è¨ˆã€ãŒç¨è¾¼ã‹ç¨æŠœã‹èª­ã¿å–ã‚Œãªã„ãŸã‚ã€ä¸€èˆ¬çš„ãªã‚¤ãƒ³ãƒœã‚¤ã‚¹ã®ã€Œç¨æŠœé‡‘é¡ã€ã‚’è¡¨ç¤ºã—ã¾ã™ï¼‰
            // ã‚‚ã—ç”»åƒãŒã€Œç¨è¾¼é‡‘é¡ã€ã®å°è¨ˆãªã‚‰ in10 ã‚’è¡¨ç¤ºã™ã‚Œã°OKã§ã™ã€‚
            // ã“ã“ã§ã¯ç”»åƒã«ã‚ã‚‹ã€Œå°è¨ˆã€ï¼ã€Œç¨æŠœé‡‘é¡ã€ã¨ã—ã¦è¨ˆç®—ã—ã¦ã„ã¾ã™ã€‚
            
            // ä¿®æ­£æ¡ˆï¼šç”»åƒã®æ•°å­—ã‚’è¦‹ã‚‹ã¨ã€10000+10000=20000ã€æ¶ˆè²»ç¨1000+800=1800ã€åˆè¨ˆ21800ã¨ãªã£ã¦ã„ã¾ã™ã€‚
            // ã¤ã¾ã‚Šã€ç”»åƒã®ã€Œå°è¨ˆã€ã¯ã€ç¨æŠœã€ã®ã“ã¨ã§ã™ã­ã€‚
            
            document.getElementById('viewSub10').innerText = fmt(sub10);
            document.getElementById('viewSub8').innerText = fmt(sub8);
            document.getElementById('viewTax10').innerText = fmt(tax10);
            document.getElementById('viewTax8').innerText = fmt(tax8);
        }
    </script>
</body>
</html>

