<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ¨è·è¨¼æ˜æ›¸ä½œæˆãƒ„ãƒ¼ãƒ«</title>
    <style>
        /* --- å…¨ä½“ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        body {
            /* æœ€åˆã¯éš ã—ã¦ãŠãï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚ï¼‰ */
            display: none; 
            
            font-family: "Helvetica Neue", Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
            gap: 20px;
            justify-content: center;
            min-height: 100vh;
        }

        /* --- å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚¨ãƒªã‚¢ --- */
        .editor-pane {
            width: 350px;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            height: fit-content;
        }
        .editor-pane h2 { font-size: 18px; margin-bottom: 15px; border-bottom: 2px solid #ddd; padding-bottom: 5px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 12px; font-weight: bold; margin-bottom: 5px; color: #555; }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }
        button.print-btn {
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
        }
        button.print-btn:hover { background-color: #0056b3; }

        /* --- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ï¼ˆA4ç”¨ç´™ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰ --- */
        .preview-pane {
            flex-grow: 1;
            display: flex;
            justify-content: center;
        }
        
        #certificate {
            width: 210mm; /* A4å¹… */
            min-height: 297mm; /* A4é«˜ã• */
            background: white;
            padding: 20mm; /* ä½™ç™½ */
            box-sizing: border-box;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            position: relative;
            
            /* ãƒ•ã‚©ãƒ³ãƒˆè¨­å®šï¼šæ˜æœä½“ã§å…¬çš„æ–‡æ›¸æ„Ÿã‚’å‡ºã™ */
            font-family: "Yu Mincho", "YuMincho", "Hiragino Mincho ProN", "HGS Mincho E", serif;
            color: #000;
        }

        /* --- è¨¼æ˜æ›¸ã®ä¸­èº«ã®ãƒ‡ã‚¶ã‚¤ãƒ³ --- */
        .cert-title {
            text-align: center;
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 40px;
            letter-spacing: 5px;
            text-decoration: underline double; /* äºŒé‡ä¸‹ç·š */
        }

        .cert-date {
            text-align: right;
            margin-bottom: 30px;
        }

        .cert-body {
            margin-bottom: 40px;
            line-height: 2;
        }

        .cert-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 50px;
            border: 2px solid #333;
        }
        .cert-table th, .cert-table td {
            border: 1px solid #333;
            padding: 12px 15px;
            vertical-align: middle;
        }
        .cert-table th {
            width: 30%;
            background-color: #f9f9f9;
            text-align: left;
            font-weight: normal;
        }
        .cert-table td {
            width: 70%;
            font-weight: bold;
            font-size: 18px;
        }

        .cert-footer {
            margin-top: 50px;
            text-align: right;
            line-height: 1.6;
        }
        .company-name { font-size: 20px; font-weight: bold; margin-top: 10px; }
        .ceo-name { font-size: 18px; margin-top: 5px; }

        /* --- å°åˆ·æ™‚ã®è¨­å®š --- */
        @media print {
            body {
                background: none;
                margin: 0;
                padding: 0;
                display: block !important; /* å°åˆ·æ™‚ã¯å¿…ãšãƒ–ãƒ­ãƒƒã‚¯è¡¨ç¤º */
            }
            .editor-pane { display: none; } /* ãƒ•ã‚©ãƒ¼ãƒ ã‚’æ¶ˆã™ */
            .preview-pane { display: block; }
            #certificate {
                box-shadow: none;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 20mm; /* å°åˆ·æ™‚ã®ä½™ç™½ç¢ºä¿ */
                page-break-after: always;
            }
            @page { margin: 0; size: A4 portrait; }
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼ˆã‚¹ãƒãƒ›ãªã©ã¯ç¸¦ä¸¦ã³ï¼‰ */
        @media (max-width: 900px) {
            body { flex-direction: column; align-items: center; }
            .editor-pane { width: 100%; max-width: 500px; }
            #certificate { width: 100%; font-size: 0.9em; padding: 10mm;}
        }
    </style>
</head>
<body>

    <!-- â–¼â–¼â–¼ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ï¼ˆã“ã“ãŒé‡è¦ï¼ï¼‰ â–¼â–¼â–¼ -->
    <script src="auth.js"></script>
    <script>
        // auth.jsã®æ‰‹å½¢ãƒã‚§ãƒƒã‚¯ã‚’ä½¿ã†ãŒã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ(flex)ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã«æ‰‹å‹•ã§è¨­å®š
        if (sessionStorage.getItem("access_token") !== "allowed") {
            alert("ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“ã€‚ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ã«æˆ»ã‚Šã¾ã™ã€‚");
            window.location.href = "index.html";
        } else {
            // ãƒ­ã‚°ã‚¤ãƒ³OKãªã‚‰ã€ã“ã®ãƒšãƒ¼ã‚¸å°‚ç”¨ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ(flex)ã§è¡¨ç¤ºã™ã‚‹
            document.body.style.display = "flex";
        }
    </script>
    <!-- â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–² -->


    <!-- å·¦å´ï¼šå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="editor-pane">
        <h2>å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ </h2>
        
        <div class="form-group">
            <label>è¨¼æ˜æ—¥ (ç™ºè¡Œæ—¥)</label>
            <input type="date" id="issueDate">
        </div>

        <hr>

        <div class="form-group">
            <label>æ°å</label>
            <input type="text" id="name" placeholder="å±±ç”° å¤ªéƒ">
        </div>
        <div class="form-group">
            <label>ç”Ÿå¹´æœˆæ—¥</label>
            <input type="date" id="birthDate">
        </div>
        <div class="form-group">
            <label>ä½æ‰€</label>
            <input type="text" id="address" placeholder="æ±äº¬éƒ½åƒä»£ç”°åŒº...">
        </div>
        <div class="form-group">
            <label>åœ¨è·æœŸé–“ (é–‹å§‹)</label>
            <input type="date" id="periodStart">
        </div>
        <div class="form-group">
            <label>åœ¨è·æœŸé–“ (çµ‚äº†/ç¾åœ¨)</label>
            <input type="text" id="periodEnd" placeholder="ç¾åœ¨ã«è‡³ã‚‹ã€ã¾ãŸã¯æ—¥ä»˜">
        </div>
        <div class="form-group">
            <label>æ‰€å±ãƒ»å½¹è·</label>
            <input type="text" id="department" placeholder="å–¶æ¥­éƒ¨ èª²é•·">
        </div>
        <div class="form-group">
            <label>æ¥­å‹™å†…å®¹</label>
            <textarea id="jobDesc" rows="2" placeholder="å–¶æ¥­æ´»å‹•ãŠã‚ˆã³ãƒãƒ¼ãƒ ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ"></textarea>
        </div>

        <hr>

        <div class="form-group">
            <label>ä¼šç¤¾ä½æ‰€</label>
            <input type="text" id="compAddress" placeholder="æ±äº¬éƒ½æ¸¯åŒº...">
        </div>
        <div class="form-group">
            <label>ä¼šç¤¾å</label>
            <input type="text" id="compName" placeholder="æ ªå¼ä¼šç¤¾ã€‡ã€‡">
        </div>
        <div class="form-group">
            <label>ä»£è¡¨è€…å</label>
            <input type="text" id="compRep" placeholder="ä»£è¡¨å–ç· å½¹ ä½è—¤ æ¬¡éƒ">
        </div>

        <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ å°åˆ·ã™ã‚‹ / PDFä¿å­˜</button>
    </div>

    <!-- å³å´ï¼šãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
    <div class="preview-pane">
        <div id="certificate">
            <div class="cert-title">åœ¨è·è¨¼æ˜æ›¸</div>
            
            <div class="cert-date">
                <span id="viewIssueDate">ä»¤å’Œã€‡å¹´ã€‡æœˆã€‡æ—¥</span>
            </div>

            <div class="cert-body">
                ä¸‹è¨˜ã®è€…ã¯ã€å½“ç¤¾ã«åœ¨è·ã—ã¦ã„ã‚‹ï¼ˆã—ã¦ã„ãŸï¼‰ã“ã¨ã‚’è¨¼æ˜ã—ã¾ã™ã€‚
            </div>

            <table class="cert-table">
                <tr>
                    <th>æ° å</th>
                    <td id="viewName"></td>
                </tr>
                <tr>
                    <th>ç”Ÿå¹´æœˆæ—¥</th>
                    <td id="viewBirthDate"></td>
                </tr>
                <tr>
                    <th>ä½ æ‰€</th>
                    <td id="viewAddress"></td>
                </tr>
                <tr>
                    <th>åœ¨è·æœŸé–“</th>
                    <td>
                        <span id="viewPeriodStart"></span> ã€œ <span id="viewPeriodEnd"></span>
                    </td>
                </tr>
                <tr>
                    <th>æ‰€å±ãƒ»å½¹è·</th>
                    <td id="viewDepartment"></td>
                </tr>
                <tr>
                    <th>æ¥­å‹™å†…å®¹</th>
                    <td id="viewJobDesc"></td>
                </tr>
            </table>

            <div class="cert-footer">
                <div id="viewCompAddress"></div>
                <div class="company-name" id="viewCompName"></div>
                <div class="ceo-name" id="viewCompRep"></div>
                <!-- ã“ã“ã«ãƒãƒ³ã‚³ç”»åƒç”¨ã®imgã‚¿ã‚°ã‚’å…¥ã‚Œã‚‹ã“ã¨ã‚‚å¯èƒ½ -->
                <div style="margin-top:20px; color:#ccc; font-size:12px;">(ç¤¾å°)</div>
            </div>
        </div>
    </div>

    <script>
        // æ—¥ä»˜ã‚’ã€Œä»¤å’Œã€‡å¹´ã€‡æœˆã€‡æ—¥ã€ã‚„ã€ŒYYYYå¹´MMæœˆDDæ—¥ã€å½¢å¼ã«ã™ã‚‹é–¢æ•°
        function formatDate(dateStr) {
            if (!dateStr) return "";
            const d = new Date(dateStr);
            // æ—¥æœ¬èªå½¢å¼ã«å¤‰æ› (ã‚·ãƒ³ãƒ—ãƒ«ã«å¹´æœˆæ—¥)
            return `${d.getFullYear()}å¹´${d.getMonth() + 1}æœˆ${d.getDate()}æ—¥`;
        }

        // å…¥åŠ›ã‚’åæ˜ ã•ã›ã‚‹é–¢æ•°
        function updateCert() {
            // è¨¼æ˜æ—¥
            const issueDateVal = document.getElementById('issueDate').value;
            document.getElementById('viewIssueDate').innerText = issueDateVal ? formatDate(issueDateVal) : "ä»¤å’Œã€€å¹´ã€€æœˆã€€æ—¥";

            // å€‹äººæƒ…å ±
            document.getElementById('viewName').innerText = document.getElementById('name').value;
            document.getElementById('viewBirthDate').innerText = formatDate(document.getElementById('birthDate').value);
            document.getElementById('viewAddress').innerText = document.getElementById('address').value;
            
            // åœ¨è·æœŸé–“
            const startVal = document.getElementById('periodStart').value;
            document.getElementById('viewPeriodStart').innerText = formatDate(startVal);
            document.getElementById('viewPeriodEnd').innerText = document.getElementById('periodEnd').value;

            // æ¥­å‹™ãƒ»æ‰€å±
            document.getElementById('viewDepartment').innerText = document.getElementById('department').value;
            document.getElementById('viewJobDesc').innerText = document.getElementById('jobDesc').value;

            // ä¼šç¤¾æƒ…å ±
            document.getElementById('viewCompAddress').innerText = document.getElementById('compAddress').value;
            document.getElementById('viewCompName').innerText = document.getElementById('compName').value;
            document.getElementById('viewCompRep').innerText = document.getElementById('compRep').value;
        }

        // å…¨ã¦ã®input/textareaã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ã¤ã‘ã‚‹
        const inputs = document.querySelectorAll('input, textarea');
        inputs.forEach(input => {
            input.addEventListener('input', updateCert);
        });

        // åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚ã«ä»Šæ—¥ã®æ—¥ä»˜ãªã©ã‚’ã‚»ãƒƒãƒˆã—ã¦ãŠãï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
        document.getElementById('issueDate').valueAsDate = new Date();
        updateCert();
    </script>
</body>
</html>