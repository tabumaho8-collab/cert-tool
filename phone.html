<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Memo</title>
    <link
        href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="theme.css">
    <style>
        /* =========================================
           ãƒ†ãƒ¼ãƒå®šç¾© (CSSå¤‰æ•°)
           ========================================= */
        :root {
            /* Stylish (Default) */
            --bg-color: #f4f7f6;
            --bg-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --font-family: "Helvetica Neue", "Noto Sans JP", Arial, sans-serif;
            --text-color: #2d3436;
            --accent-color: #6c5ce7;
            --accent-sub: #a29bfe;
            --card-bg: rgba(255, 255, 255, 0.9);
            --header-bg: #2d3436;
            --header-text: #ffffff;
            --border-radius: 12px;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            --input-bg: #fff;
            --input-border: #dfe6e9;
            --check-bg: #fff;
            --btn-radius: 6px;
            --back-btn-bg: #636e72;
            --back-btn-text: #fff;
        }

        /* Kawaii (æ°´è‰²ãƒœã‚¿ãƒ³å¾©æ´»ï¼) */
        body.theme-kawaii {
            --bg-color: #fff0f6;
            --bg-image: radial-gradient(#ffcdd2 20%, transparent 20%), radial-gradient(#ffcdd2 20%, transparent 20%);
            --font-family: "M PLUS Rounded 1c", sans-serif;
            --text-color: #5d4037;
            --accent-color: #ff6b81;
            --accent-sub: #ff9eb5;
            --card-bg: rgba(255, 255, 255, 0.95);
            --header-bg: #ff9eb5;
            --header-text: #ffffff;
            --border-radius: 25px;
            --shadow: 0 10px 20px rgba(255, 105, 180, 0.15);
            --input-bg: #fff;
            --input-border: #ffdde1;
            --check-bg: #fff;
        }

        /* Dark */
        body.theme-dark {
            --bg-color: #050508;
            --bg-image: linear-gradient(rgba(0, 229, 255, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 229, 255, 0.05) 1px, transparent 1px);
            --font-family: "Helvetica Neue", "Noto Sans JP", Arial, sans-serif;
            --text-color: #e0f7fa;
            --accent-color: #00e5ff;
            --accent-sub: #00b8d4;
            --card-bg: rgba(20, 30, 50, 0.8);
            --header-bg: rgba(5, 10, 20, 0.95);
            --header-text: #00e5ff;
            --border-radius: 6px;
            --shadow: 0 0 20px rgba(0, 229, 255, 0.1);
            --input-bg: rgba(0, 0, 0, 0.5);
            --input-border: #00e5ff;
            --check-bg: rgba(0, 0, 0, 0.5);
        }

        /* --- åŸºæœ¬ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            background-image: var(--bg-image);
            background-size: cover;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            color: var(--text-color);
            transition: 0.3s;
        }

        body.theme-kawaii {
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
        }

        body.theme-dark {
            background-size: 40px 40px;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        header {
            background-color: var(--header-bg);
            color: var(--header-text);
            width: 100%;
            padding: 12px 25px;
            box-sizing: border-box;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 1000;
            flex-shrink: 0;
            backdrop-filter: blur(5px);
        }

        h1 {
            margin: 0;
            font-size: 18px;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .header-btns {
            display: flex;
            gap: 10px;
        }

        /* ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ãƒœã‚¿ãƒ³ */
        .theme-btn {
            background: rgba(255, 255, 255, 0.2);
            color: inherit;
            border: 1px solid rgba(255, 255, 255, 0.4);
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            font-weight: bold;
        }

        .theme-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        body.theme-dark .theme-btn {
            border-color: var(--accent-color);
            color: var(--accent-color);
            background: rgba(0, 0, 0, 0.5);
        }

        /* --- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ --- */
        .container {
            display: flex;
            gap: 25px;
            width: 100%;
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            box-sizing: border-box;
            flex-grow: 1;
        }

        /* ã‚¨ãƒ‡ã‚£ã‚¿ã‚¨ãƒªã‚¢ */
        .editor-pane {
            flex: 1;
            min-width: 350px;
            background: var(--card-bg);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        body.theme-dark .editor-pane {
            border: 1px solid var(--accent-color);
        }

        /* â˜…å¾©æ´»ã—ãŸã€Œæˆ»ã‚‹ã€ãƒœã‚¿ãƒ³ */
        .back-btn {
            display: inline-block;
            margin-bottom: 20px;
        }

        .back-btn:active {
            transform: translateY(2px);
        }

        .reset-btn {
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            color: var(--text-color);
            padding: 5px 15px;
            border-radius: var(--btn-radius);
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            opacity: 0.7;
        }

        .reset-btn:hover {
            opacity: 1;
            border-color: var(--accent-color);
            color: var(--accent-color);
        }

        h2 {
            color: var(--accent-color);
            margin-top: 10px;
            font-size: 22px;
            text-align: center;
            border-bottom: 2px dashed var(--accent-sub);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 18px;
        }

        .form-group>label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 6px;
            color: var(--accent-color);
        }

        body.theme-kawaii .form-group>label span::before {
            content: "â™¥ ";
            color: var(--accent-sub);
        }

        input,
        textarea {
            width: 100%;
            padding: 12px;
            box-sizing: border-box;
            border: 2px solid var(--input-border);
            border-radius: var(--border-radius);
            font-size: 14px;
            font-family: inherit;
            background: var(--input-bg);
            color: var(--text-color);
            transition: 0.3s;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.2);
        }

        body.theme-kawaii input:focus,
        body.theme-kawaii textarea:focus {
            box-shadow: 0 0 0 3px rgba(255, 158, 181, 0.2);
        }

        body.theme-dark input:focus,
        body.theme-dark textarea:focus {
            box-shadow: 0 0 10px var(--accent-color);
        }

        /* ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆ */
        .member-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 5px;
            margin-bottom: 5px;
        }

        .member-chip {
            background-color: var(--bg-color);
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            padding: 4px 8px 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .member-chip:hover {
            background-color: var(--accent-color);
            color: #fff;
            transform: translateY(-2px);
        }

        body.theme-dark .member-chip:hover {
            color: #000;
        }

        .chip-delete {
            width: 18px;
            height: 18px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            line-height: 1;
        }

        .chip-delete:hover {
            background: #ff5252;
            color: white;
        }

        /* è¨­å®šã‚¨ãƒªã‚¢ */
        .member-settings {
            background: var(--bg-color);
            padding: 10px;
            border-radius: 10px;
            margin-top: 5px;
            border: 1px dashed var(--accent-color);
            display: none;
        }

        .add-row {
            display: flex;
            gap: 5px;
        }

        .add-row input {
            padding: 8px;
            font-size: 12px;
        }

        .small-btn {
            padding: 8px 12px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
        }

        body.theme-dark .small-btn {
            color: #000;
        }

        .edit-toggle {
            font-size: 11px;
            cursor: pointer;
            opacity: 0.7;
            text-decoration: underline;
        }

        .edit-toggle:hover {
            color: var(--accent-color);
            opacity: 1;
        }

        /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ */
        .check-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .check-item {
            border: 1px solid var(--input-border);
            border-radius: var(--border-radius);
            padding: 10px;
            background: var(--check-bg);
            transition: 0.2s;
            cursor: pointer;
        }

        .check-item:has(input:checked) {
            background: var(--bg-color);
            border-color: var(--accent-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .check-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            justify-content: flex-start;
        }

        input[type="checkbox"] {
            accent-color: var(--accent-color);
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .sub-input {
            margin-top: 10px;
            margin-left: 28px;
            display: none;
        }

        .check-item:has(input:checked) .sub-input {
            display: block;
            animation: popIn 0.3s;
        }

        @keyframes popIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #saveMsg {
            font-size: 11px;
            color: #4caf50;
            margin-top: 5px;
            text-align: right;
            display: none;
            font-weight: bold;
        }

        /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ */
        .preview-pane {
            width: 500px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            flex-shrink: 0;
        }

        .result-container {
            width: 100%;
            box-sizing: border-box;
            background: #fff;
            padding: 10px;
            border-radius: 20px;
            border-top: 8px solid var(--accent-sub);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .result-box {
            background: #fffcf0;
            color: #5d4037;
            padding: 20px;
            border-radius: 10px;
            font-family: monospace;
            line-height: 1.7;
            white-space: pre-wrap;
            font-size: 13px;
            min-height: 300px;
            border: 2px dashed #e0e0e0;
        }

        .copy-btn {
            width: 100%;
            padding: 15px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: var(--btn-radius);
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;
            position: relative;
            overflow: hidden;
        }

        body.theme-kawaii .copy-btn {
            background: linear-gradient(45deg, #ff9eb5, #ff6b81);
            border-radius: 50px;
        }

        body.theme-dark .copy-btn {
            background: rgba(0, 229, 255, 0.2);
            color: #00e5ff;
            border: 1px solid #00e5ff;
            box-shadow: 0 0 10px #00e5ff;
        }

        .copy-btn:hover {
            transform: translateY(-3px);
            opacity: 0.9;
        }

        .helper-text {
            font-size: 11px;
            text-align: center;
            color: var(--accent-color);
            font-weight: bold;
        }

        @media (max-width: 900px) {
            .container {
                flex-direction: column;
            }

            .preview-pane {
                width: 100%;
            }

            .editor-pane {
                min-width: auto;
            }
        }
    </style>
</head>

<body>
    <header>
        <h1>Phone Memo</h1>
        <div class="header-btns">
            <button onclick="toggleTheme()" id="themeBtn" class="theme-btn">ğŸ¨ ãƒ‡ã‚¶ã‚¤ãƒ³å¤‰æ›´</button>
        </div>
    </header>

    <div class="container">
        <div class="editor-pane">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <!-- â˜…å¾©æ´»: æ°´è‰²ã®æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
                <a href="index.html" class="back-btn">â¬… ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</a>
                <button class="reset-btn" onclick="resetForm()">ãƒªã‚»ãƒƒãƒˆ</button>
            </div>

            <h2>ğŸ“ é›»è©±ãƒ¡ãƒ¢</h2>

            <div class="form-group">
                <label><span>ãŠç›¸æ‰‹ (ä¼šç¤¾åãƒ»æ°å)</span></label>
                <input type="text" id="iptFrom" placeholder="ä¾‹ï¼šã€‡ã€‡å•†äº‹ ç”°ä¸­æ§˜" oninput="update()">
            </div>

            <!-- å®›å…ˆ (To) -->
            <div class="form-group">
                <label>
                    <span>ç¤¾å†…ã®èª°å®›ï¼Ÿ</span>
                    <span class="edit-toggle" onclick="toggleSettingsBox('to')">âš™ï¸è¿½åŠ </span>
                </label>
                <div id="settingsTo" class="member-settings">
                    <div class="add-row">
                        <input type="text" id="newMemberTo" placeholder="ä¾‹ï¼šä½è—¤ã•ã‚“">
                        <button class="small-btn" onclick="addMember('to')">è¿½åŠ ã™ã‚‹</button>
                    </div>
                </div>
                <div id="memberListTo" class="member-list"></div>
                <input type="text" id="iptTo" placeholder="å…¥åŠ›ã¾ãŸã¯ä¸Šã®ãƒœã‚¿ãƒ³ã‚’é¸æŠ" oninput="update()">
            </div>

            <div class="form-group">
                <label><span>ã©ã†ã™ã‚‹ï¼Ÿ (è¤‡æ•°ãˆã‚‰ã¹ã‚‹ã‚ˆ)</span></label>
                <div class="check-group">
                    <div class="check-item">
                        <label class="check-label"><input type="checkbox" id="chkCallback" onchange="update()"> ğŸ“
                            æŠ˜ã‚Šè¿”ã—é›»è©±ã—ã¦ã»ã—ã„</label>
                        <div class="sub-input"><input type="text" id="iptTel" placeholder="ç›¸æ‰‹ã®ç•ªå·: 03-0000-0000"
                                oninput="update()"></div>
                    </div>
                    <div class="check-item">
                        <label class="check-label"><input type="checkbox" id="chkAgain" onchange="update()"> ğŸ”
                            ã¾ãŸæ›ã‘ç›´ã™ãã†ã§ã™</label>
                        <div class="sub-input"><input type="text" id="iptTime" placeholder="ã„ã¤é ƒï¼Ÿ (ä¾‹: æœ¬æ—¥15æ™‚é ƒ)"
                                oninput="update()"></div>
                    </div>
                    <div class="check-item">
                        <label class="check-label"><input type="checkbox" id="chkReceived" onchange="update()"> ğŸ“±
                            é›»è©±ãŒã‚ã£ãŸã“ã¨ã ã‘å ±å‘Š</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label><span>ä¼è¨€ãƒ¡ãƒ¢ (ãã‚ã—ã)</span></label>
                <textarea id="iptMsg" rows="4" placeholder="ä¾‹ï¼šè¦‹ç©æ›¸ã®ä»¶ã«ã¤ã„ã¦ç¢ºèªã—ãŸã„ãã†ã§ã™ã€‚" oninput="update()"></textarea>
            </div>

            <!-- å—é›»è€… (Me) -->
            <div class="form-group">
                <label>
                    <span>é›»è©±ã¨ã£ãŸäºº (è‡ªåˆ†)</span>
                    <span class="edit-toggle" onclick="toggleSettingsBox('me')">âš™ï¸è¿½åŠ </span>
                </label>
                <div id="settingsMe" class="member-settings">
                    <div class="add-row">
                        <input type="text" id="newMemberMe" placeholder="ä¾‹ï¼šè‡ªåˆ†(ç”°ä¸­)">
                        <button class="small-btn" onclick="addMember('me')">è¿½åŠ ã™ã‚‹</button>
                    </div>
                </div>
                <div id="memberListMe" class="member-list"></div>
                <input type="text" id="iptMe" placeholder="è‡ªåˆ†ã®åå‰" oninput="update(); saveName();">
                <div id="saveMsg">âœ… æ¬¡å›ã‹ã‚‰ã“ã®åå‰ã«ãªã‚Šã¾ã™</div>
            </div>
        </div>

        <div class="preview-pane">
            <div class="result-container">
                <div class="result-box" id="resultText"></div>
            </div>
            <button class="copy-btn" onclick="copyToClipboard()">ã‚³ãƒ”ãƒ¼ã™ã‚‹</button>
            <p class="helper-text">â†‘ ã“ã‚Œã‚’æŠ¼ã—ã¦LINEã‚„Slackã«ãƒšã‚¿ãƒƒï¼</p>
        </div>
    </div>

    <script src="auth.js"></script>
    <script>
        if (typeof checkAuth === 'function') checkAuth(); else document.body.style.display = "flex";

        const KEY_PHONE_ME = "my_tool_phone_receiver";
        const KEY_COMPANY = "my_tool_company_info";
        const KEY_MEMBERS_TO = "my_tool_phone_members_to";
        const KEY_MEMBERS_ME = "my_tool_phone_members_me";
        const THEMES = ['', 'theme-kawaii', 'theme-dark'];

        window.onload = function () {
            // ãƒ†ãƒ¼ãƒå¾©å…ƒ
            const savedTheme = localStorage.getItem('my_tool_theme');
            if (savedTheme && THEMES.includes(savedTheme)) {
                document.body.className = savedTheme;
            }
            updateBtnText();

            let initialName = localStorage.getItem(KEY_PHONE_ME);
            if (!initialName) {
                const savedCompany = localStorage.getItem(KEY_COMPANY);
                if (savedCompany) {
                    try {
                        const data = JSON.parse(savedCompany);
                        if (data.rep) initialName = data.rep;
                    } catch (e) { }
                }
            }
            if (initialName) document.getElementById('iptMe').value = initialName;

            renderMembers('to');
            renderMembers('me');
            update();
        };

        function toggleTheme() {
            const body = document.body;
            let currentClass = "";
            if (body.classList.contains('theme-kawaii')) currentClass = 'theme-kawaii';
            else if (body.classList.contains('theme-dark')) currentClass = 'theme-dark';

            const currentIndex = THEMES.indexOf(currentClass);
            const nextIndex = (currentIndex + 1) % THEMES.length;
            const nextClass = THEMES[nextIndex];

            body.className = nextClass;
            localStorage.setItem('my_tool_theme', nextClass);
            updateBtnText();
        }

        function updateBtnText() {
            const btn = document.getElementById('themeBtn');
            const body = document.body;
            if (body.classList.contains('theme-kawaii')) {
                btn.innerText = "ğŸ’– ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ (æ¬¡:Neon)";
                btn.style.color = "#fff"; btn.style.borderColor = "#fff";
            } else if (body.classList.contains('theme-dark')) {
                btn.innerText = "âš¡ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ (æ¬¡:Simple)";
                btn.style.color = "#00e5ff"; btn.style.borderColor = "#00e5ff";
            } else {
                btn.innerText = "âœ¨ ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ (æ¬¡:Kawaii)";
                btn.style.color = "#fff"; btn.style.borderColor = "rgba(255,255,255,0.5)";
            }
        }

        function getMembers(type) {
            const key = (type === 'to') ? KEY_MEMBERS_TO : KEY_MEMBERS_ME;
            const json = localStorage.getItem(key);
            return json ? JSON.parse(json) : [];
        }

        function renderMembers(type) {
            const list = getMembers(type);
            const container = document.getElementById(type === 'to' ? 'memberListTo' : 'memberListMe');
            container.innerHTML = "";

            list.forEach((name, index) => {
                const chip = document.createElement("div");
                chip.className = "member-chip";

                const nameSpan = document.createElement("span");
                nameSpan.innerText = name;
                nameSpan.style.flex = "1";
                nameSpan.onclick = () => {
                    const targetId = (type === 'to') ? 'iptTo' : 'iptMe';
                    document.getElementById(targetId).value = name;
                    if (type === 'me') saveName();
                    update();
                };

                const deleteBtn = document.createElement("span");
                deleteBtn.className = "chip-delete";
                deleteBtn.innerText = "Ã—";
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    removeMember(type, index);
                };

                chip.appendChild(nameSpan);
                chip.appendChild(deleteBtn);
                container.appendChild(chip);
            });
        }

        function toggleSettingsBox(type) {
            const box = document.getElementById(type === 'to' ? 'settingsTo' : 'settingsMe');
            box.style.display = (box.style.display === "block") ? "none" : "block";
        }

        function addMember(type) {
            const inputId = (type === 'to') ? 'newMemberTo' : 'newMemberMe';
            const input = document.getElementById(inputId);
            const name = input.value.trim();
            if (!name) return;

            const list = getMembers(type);
            list.push(name);
            localStorage.setItem((type === 'to') ? KEY_MEMBERS_TO : KEY_MEMBERS_ME, JSON.stringify(list));

            input.value = "";
            renderMembers(type);
        }

        function removeMember(type, index) {
            if (!confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
            const list = getMembers(type);
            list.splice(index, 1);
            localStorage.setItem((type === 'to') ? KEY_MEMBERS_TO : KEY_MEMBERS_ME, JSON.stringify(list));
            renderMembers(type);
        }

        function saveName() {
            const me = document.getElementById('iptMe').value;
            localStorage.setItem(KEY_PHONE_ME, me);
            const msg = document.getElementById('saveMsg');
            msg.style.display = "block";
            setTimeout(() => { msg.style.display = "none"; }, 3000);
        }

        function update() {
            const date = new Date();
            const timeStr = `${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
            const to = document.getElementById('iptTo').value || "ã€‡ã€‡ã•ã‚“";
            const from = document.getElementById('iptFrom').value || "ãŠå®¢æ§˜";
            const me = document.getElementById('iptMe').value;
            const msg = document.getElementById('iptMsg').value;

            let text = `ã€é›»è©±ãƒ¡ãƒ¢ã€‘ ${timeStr} å—é›»\n`;
            text += `${to} æ®¿\n`;
            text += `--------------------------------\n`;
            text += `å…ˆã»ã©ã€\n`;
            text += `ã€ ${from} ã€‘ã‚ˆã‚ŠãŠé›»è©±ãŒã‚ã‚Šã¾ã—ãŸã€‚\n\n`;

            let actions = [];
            if (document.getElementById('chkReceived').checked) actions.push("ãƒ»ãŠé›»è©±ãŒã‚ã£ãŸæ—¨ã€ãŠä¼ãˆã—ã¾ã™ã€‚");
            if (document.getElementById('chkCallback').checked) {
                const tel = document.getElementById('iptTel').value;
                let line = "ãƒ»æŠ˜ã‚Šè¿”ã—ãŠé›»è©±ã‚’ã„ãŸã ããŸã„ã¨ã®ã“ã¨ã§ã™ã€‚";
                if (tel) line += `\n  (é€£çµ¡å…ˆ: ${tel})`;
                actions.push(line);
            }
            if (document.getElementById('chkAgain').checked) {
                const time = document.getElementById('iptTime').value;
                let line = "ãƒ»ã¾ãŸæ”¹ã‚ã¾ã™ã¨ã®ã“ã¨ã§ã™ã€‚";
                if (time) line += `\n  (ç›®å®‰: ${time})`;
                actions.push(line);
            }

            if (actions.length > 0) {
                text += actions.join("\n\n");
                text += `\n\n`;
            }

            if (msg.trim() !== "") {
                text += `ã€ä¼è¨€ãƒ»è©³ç´°ã€‘\n${msg}\n\n`;
            } else if (actions.length === 0) {
                text += `(ç”¨ä»¶ã®å…¥åŠ›ã‚’ãŠå¾…ã¡ã—ã¦ã„ã¾ã™)\n\n`;
            }

            text += `--------------------------------\n`;
            text += `å—é›»: ${me}`;

            document.getElementById('resultText').innerText = text;
        }

        function copyToClipboard() {
            const text = document.getElementById('resultText').innerText;
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.querySelector('.copy-btn');
                const original = btn.innerHTML;
                btn.innerHTML = "ã‚³ãƒ”ãƒ¼å®Œäº†ï¼ğŸ‘Œ";
                if (document.body.classList.contains('theme-dark')) {
                    btn.style.background = "#00e5ff"; btn.style.color = "#000";
                } else if (document.body.classList.contains('theme-kawaii')) {
                    btn.style.background = "linear-gradient(45deg, #43a047, #66bb6a)";
                } else {
                    btn.style.background = "#6c5ce7";
                }
                setTimeout(() => {
                    btn.innerHTML = original;
                    btn.style.background = ""; btn.style.color = "";
                }, 2000);
            });
        }

        function resetForm() {
            const me = document.getElementById('iptMe').value;
            document.querySelectorAll('input[type="text"], textarea').forEach(e => e.value = "");
            document.querySelectorAll('input[type="checkbox"]').forEach(e => e.checked = false);
            document.getElementById('iptMe').value = me;
            update();
        }
    </script>
</body>

</html>