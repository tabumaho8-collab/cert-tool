<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Memo ğŸ’–</title>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --main-pink: #ff9eb5;
            --light-pink: #fff0f5;
            --text-color: #5d4037;
        }

        body {
            font-family: "M PLUS Rounded 1c", sans-serif;
            background-color: #fff0f6;
            background-image: radial-gradient(#ffcdd2 20%, transparent 20%), radial-gradient(#ffcdd2 20%, transparent 20%);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            color: var(--text-color);
        }
        
        .container {
            display: flex;
            gap: 25px;
            width: 100%;
            max-width: 950px;
        }
        
        .editor-pane {
            flex: 1;
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 25px;
            border: 3px solid #fff;
            box-shadow: 0 10px 20px rgba(255, 105, 180, 0.15);
        }

        .back-btn {
            display: inline-block;
            background-color: #b2ebf2;
            color: var(--text-color);
            padding: 6px 12px;
            text-decoration: none;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 15px;
            box-shadow: 2px 2px 0px #80deea;
            transition: transform 0.1s;
        }
        .back-btn:active { transform: translateY(2px); box-shadow: none; }
        
        h2 {
            color: #ff6b81;
            margin-top: 0;
            font-size: 22px;
            text-align: center;
            border-bottom: 2px dashed #ff9eb5;
            padding-bottom: 10px;
        }

        .form-group { margin-bottom: 18px; }
        
        /* â˜…ä¿®æ­£: ç›´ä¸‹ã®å­è¦ç´ (>)ã ã‘ã«é™å®šã™ã‚‹ã“ã¨ã§ã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¸ã®å½±éŸ¿ã‚’é˜²ã */
        .form-group > label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 6px;
            color: #ff6b81;
        }
        .form-group > label span::before { content: "â™¥ "; color: #ff9eb5; }

        input, textarea {
            width: 100%;
            padding: 12px;
            box-sizing: border-box;
            border: 2px solid #ffdde1;
            border-radius: 15px;
            font-size: 14px;
            font-family: inherit;
            background: #fff;
            transition: 0.3s;
            color: var(--text-color);
        }
        input:focus, textarea:focus {
            outline: none;
            border-color: #ff9eb5;
            box-shadow: 0 0 0 3px rgba(255, 158, 181, 0.2);
        }

        /* --- ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆï¼ˆãƒãƒƒãƒ—ï¼‰ã®æ”¹è‰¯ --- */
        .member-list { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 5px; margin-bottom: 5px; }
        
        .member-chip {
            background-color: #fff0f5;
            border: 1px solid #ff9eb5;
            color: #ff6b81;
            padding: 4px 8px 4px 12px; /* å³å´ï¼ˆÃ—ãƒœã‚¿ãƒ³ï¼‰ã®ä½™ç™½èª¿æ•´ */
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .member-chip:hover {
            background-color: #ffe0e9;
            transform: translateY(-2px);
        }
        
        /* å‰Šé™¤ãƒœã‚¿ãƒ³(Ã—)ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .chip-delete {
            width: 18px;
            height: 18px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #ff6b81;
            font-size: 10px;
            line-height: 1;
        }
        .chip-delete:hover {
            background: #ff6b81;
            color: white;
        }

        /* è¨­å®šã‚¨ãƒªã‚¢ */
        .member-settings {
            background: #fdf2f4; padding: 10px; border-radius: 10px; margin-top: 5px;
            border: 1px dashed #ff9eb5; display: none;
        }
        .add-row { display: flex; gap: 5px; }
        .add-row input { padding: 8px; font-size: 12px; border-radius: 8px; }
        .small-btn {
            padding: 8px 12px; background: #ff9eb5; color: white; border: none;
            border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 12px; white-space: nowrap;
        }
        .edit-toggle { font-size: 11px; cursor: pointer; color: #aaa; text-decoration: underline; }
        .edit-toggle:hover { color: #ff6b81; }

        /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ */
        .check-group { display: flex; flex-direction: column; gap: 12px; }
        .check-item { border: 2px solid #ffe0e9; border-radius: 18px; padding: 12px; background: #fff; transition: 0.2s; cursor: pointer; }
        .check-item:has(input:checked) { background: #fff0f5; border-color: #ff9eb5; transform: scale(1.02); box-shadow: 0 4px 10px rgba(255, 182, 193, 0.2); }
        
        /* â˜…ä¿®æ­£: å·¦å¯„ã›ã‚’å¼·åˆ¶ */
        .check-label { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            font-size: 14px; 
            font-weight: bold; 
            color: var(--text-color); 
            cursor: pointer;
            justify-content: flex-start !important; /* çµ¶å¯¾ã«å·¦å¯„ã› */
        }
        
        input[type="checkbox"] { accent-color: #ff6b81; width: 18px; height: 18px; cursor: pointer; }

        .sub-input { margin-top: 10px; margin-left: 28px; display: none; animation: popIn 0.3s; }
        .check-item:has(input:checked) .sub-input { display: block; }
        @keyframes popIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

        #saveMsg { font-size: 11px; color: #4caf50; margin-top: 5px; text-align: right; display: none; font-weight: bold; }

        .preview-pane { width: 380px; display: flex; flex-direction: column; gap: 15px; }
        .result-container { background: #fff; padding: 10px; border-radius: 20px; border-top: 8px solid rgba(255, 182, 193, 0.5); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .result-box { background: #fffcf0; color: #5d4037; padding: 20px; border-radius: 10px; font-family: "M PLUS Rounded 1c", monospace; line-height: 1.7; white-space: pre-wrap; font-size: 13px; min-height: 300px; border: 2px dashed #e0e0e0; }
        .copy-btn { width: 100%; padding: 15px; background: linear-gradient(45deg, #ff9eb5, #ff6b81); color: white; border: none; border-radius: 50px; font-size: 16px; font-weight: bold; font-family: inherit; cursor: pointer; box-shadow: 0 4px 10px rgba(255, 107, 129, 0.4); transition: transform 0.2s; position: relative; overflow: hidden; }
        .copy-btn:hover { transform: translateY(-3px); box-shadow: 0 6px 15px rgba(255, 107, 129, 0.6); }
        .copy-btn::after { content: "âœ¨"; position: absolute; right: 20px; top: 50%; transform: translateY(-50%); }
        .reset-btn { background: #fff; border: 2px solid #eee; color: #aaa; padding: 5px 15px; border-radius: 20px; cursor: pointer; font-size: 12px; float: right; font-weight: bold; }
        .helper-text { font-size: 11px; text-align: center; color: #ff6b81; font-weight: bold; }

        @media (max-width: 700px) { .container { flex-direction: column; } .preview-pane { width: 100%; } }
    </style>
</head>
<body>
    <script src="lock.js"></script>
    <script>if (typeof checkAuth === 'function') checkAuth(); else document.body.style.display="flex";</script>

    <div class="container">
        <div class="editor-pane">
            <a href="index.html" class="back-btn">â¬… ã‚‚ã©ã‚‹</a>
            <button class="reset-btn" onclick="resetForm()">ãƒªã‚»ãƒƒãƒˆ</button>
            <h2>ğŸ’– Phone Memo ğŸ’–</h2>

            <div class="form-group">
                <label><span>ãŠç›¸æ‰‹ (ä¼šç¤¾åãƒ»æ°å)</span></label>
                <input type="text" id="iptFrom" placeholder="ä¾‹ï¼šã€‡ã€‡å•†äº‹ ç”°ä¸­æ§˜" oninput="update()">
            </div>

            <!-- å®›å…ˆ (To) -->
            <div class="form-group">
                <label>
                    <span>ç¤¾å†…ã®èª°å®›ï¼Ÿ</span>
                    <!-- âš™ï¸ã¯è¨­å®šã‚¨ãƒªã‚¢ã®é–‹é–‰ã®ã¿ã«ä½¿ç”¨ -->
                    <span class="edit-toggle" onclick="toggleSettingsBox('to')">âš™ï¸è¿½åŠ </span>
                </label>
                
                <div id="settingsTo" class="member-settings">
                    <div class="add-row">
                        <input type="text" id="newMemberTo" placeholder="ä¾‹ï¼šä½è—¤ã•ã‚“">
                        <button class="small-btn" onclick="addMember('to')">è¿½åŠ ã™ã‚‹</button>
                    </div>
                </div>

                <div id="memberListTo" class="member-list"></div>
                <input type="text" id="iptTo" placeholder="å…¥åŠ›ã¾ãŸã¯ä¸Šã®ãƒœã‚¿ãƒ³ã‚’é¸æŠ" oninput="update()">
            </div>

            <div class="form-group">
                <label><span>ã©ã†ã™ã‚‹ï¼Ÿ (è¤‡æ•°ãˆã‚‰ã¹ã‚‹ã‚ˆ)</span></label>
                <div class="check-group">
                    <div class="check-item">
                        <label class="check-label"><input type="checkbox" id="chkCallback" onchange="update()"> ğŸ“ æŠ˜ã‚Šè¿”ã—é›»è©±ã—ã¦ã»ã—ã„</label>
                        <div class="sub-input"><input type="text" id="iptTel" placeholder="ç›¸æ‰‹ã®ç•ªå·: 03-0000-0000" oninput="update()"></div>
                    </div>
                    <div class="check-item">
                        <label class="check-label"><input type="checkbox" id="chkAgain" onchange="update()"> ğŸ” ã¾ãŸæ›ã‘ç›´ã™ãã†ã§ã™</label>
                        <div class="sub-input"><input type="text" id="iptTime" placeholder="ã„ã¤é ƒï¼Ÿ (ä¾‹: æœ¬æ—¥15æ™‚é ƒ)" oninput="update()"></div>
                    </div>
                    <div class="check-item">
                        <label class="check-label"><input type="checkbox" id="chkReceived" onchange="update()"> ğŸ“± é›»è©±ãŒã‚ã£ãŸã“ã¨ã ã‘å ±å‘Š</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label><span>ä¼è¨€ãƒ¡ãƒ¢ (ãã‚ã—ã)</span></label>
                <textarea id="iptMsg" rows="4" placeholder="ä¾‹ï¼šè¦‹ç©æ›¸ã®ä»¶ã«ã¤ã„ã¦ç¢ºèªã—ãŸã„ãã†ã§ã™ã€‚" oninput="update()"></textarea>
            </div>
            
            <!-- å—é›»è€… (Me) -->
            <div class="form-group">
                <label>
                    <span>é›»è©±ã¨ã£ãŸäºº (è‡ªåˆ†)</span>
                    <span class="edit-toggle" onclick="toggleSettingsBox('me')">âš™ï¸è¿½åŠ </span>
                </label>
                
                <div id="settingsMe" class="member-settings">
                    <div class="add-row">
                        <input type="text" id="newMemberMe" placeholder="ä¾‹ï¼šè‡ªåˆ†(ç”°ä¸­)">
                        <button class="small-btn" onclick="addMember('me')">è¿½åŠ ã™ã‚‹</button>
                    </div>
                </div>

                <div id="memberListMe" class="member-list"></div>
                <input type="text" id="iptMe" placeholder="è‡ªåˆ†ã®åå‰" oninput="update(); saveName();">
                <div id="saveMsg">âœ… æ¬¡å›ã‹ã‚‰ã“ã®åå‰ã«ãªã‚Šã¾ã™</div>
            </div>
        </div>

        <div class="preview-pane">
            <div class="result-container">
                <div class="result-box" id="resultText"></div>
            </div>
            <button class="copy-btn" onclick="copyToClipboard()">ã‚³ãƒ”ãƒ¼ã™ã‚‹ ğŸ’•</button>
            <p class="helper-text">â†‘ ã“ã‚Œã‚’æŠ¼ã—ã¦LINEã‚„Slackã«ãƒšã‚¿ãƒƒï¼</p>
        </div>
    </div>

    <script>
        const KEY_PHONE_ME = "my_tool_phone_receiver";
        const KEY_COMPANY = "my_tool_company_info";
        const KEY_MEMBERS_TO = "my_tool_phone_members_to";
        const KEY_MEMBERS_ME = "my_tool_phone_members_me";

        window.onload = function() {
            let initialName = localStorage.getItem(KEY_PHONE_ME);
            if (!initialName) {
                const savedCompany = localStorage.getItem(KEY_COMPANY);
                if (savedCompany) {
                    try {
                        const data = JSON.parse(savedCompany);
                        if (data.rep) initialName = data.rep;
                    } catch(e) {}
                }
            }
            if(initialName) document.getElementById('iptMe').value = initialName;
            
            renderMembers('to');
            renderMembers('me');
            update();
        };

        function getMembers(type) {
            const key = (type === 'to') ? KEY_MEMBERS_TO : KEY_MEMBERS_ME;
            const json = localStorage.getItem(key);
            return json ? JSON.parse(json) : [];
        }

        // â˜…ä¿®æ­£: ãƒãƒƒãƒ—ã¨å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’åˆ†é›¢
        function renderMembers(type) {
            const list = getMembers(type);
            const container = document.getElementById(type === 'to' ? 'memberListTo' : 'memberListMe');
            container.innerHTML = "";

            list.forEach((name, index) => {
                const chip = document.createElement("div");
                chip.className = "member-chip";
                
                // åå‰éƒ¨åˆ†
                const nameSpan = document.createElement("span");
                nameSpan.innerText = name;
                nameSpan.style.flex = "1";
                nameSpan.onclick = () => {
                    const targetId = (type === 'to') ? 'iptTo' : 'iptMe';
                    document.getElementById(targetId).value = name;
                    if(type === 'me') saveName();
                    update();
                };

                // å‰Šé™¤ãƒœã‚¿ãƒ³éƒ¨åˆ† (Ã—)
                const deleteBtn = document.createElement("span");
                deleteBtn.className = "chip-delete";
                deleteBtn.innerText = "Ã—";
                deleteBtn.onclick = (e) => {
                    e.stopPropagation(); // è¦ªã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ­¢ã‚ã‚‹
                    removeMember(type, index);
                };

                chip.appendChild(nameSpan);
                chip.appendChild(deleteBtn);
                container.appendChild(chip);
            });
        }

        function toggleSettingsBox(type) {
            const box = document.getElementById(type === 'to' ? 'settingsTo' : 'settingsMe');
            box.style.display = (box.style.display === "block") ? "none" : "block";
        }

        function addMember(type) {
            const inputId = (type === 'to') ? 'newMemberTo' : 'newMemberMe';
            const input = document.getElementById(inputId);
            const name = input.value.trim();
            if(!name) return;

            const list = getMembers(type);
            list.push(name);
            localStorage.setItem((type === 'to') ? KEY_MEMBERS_TO : KEY_MEMBERS_ME, JSON.stringify(list));
            
            input.value = "";
            renderMembers(type);
        }

        function removeMember(type, index) {
            if(!confirm("å‰Šé™¤ã—ã¦ã„ã„ï¼Ÿ")) return;
            const list = getMembers(type);
            list.splice(index, 1);
            localStorage.setItem((type === 'to') ? KEY_MEMBERS_TO : KEY_MEMBERS_ME, JSON.stringify(list));
            renderMembers(type);
        }

        function saveName() {
            const me = document.getElementById('iptMe').value;
            localStorage.setItem(KEY_PHONE_ME, me);
            const msg = document.getElementById('saveMsg');
            msg.style.display = "block";
            setTimeout(() => { msg.style.display = "none"; }, 3000);
        }

        function update() {
            const date = new Date();
            const timeStr = `${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
            const to = document.getElementById('iptTo').value || "ã€‡ã€‡ã•ã‚“";
            const from = document.getElementById('iptFrom').value || "ãŠå®¢æ§˜";
            const me = document.getElementById('iptMe').value;
            const msg = document.getElementById('iptMsg').value;

            let text = `ã€é›»è©±ãƒ¡ãƒ¢ã€‘ ${timeStr} å—é›»\n`;
            text += `${to} æ®¿\n`;
            text += `--------------------------------\n`;
            text += `å…ˆã»ã©ã€\n`;
            text += `ã€ ${from} ã€‘ã‚ˆã‚ŠãŠé›»è©±ãŒã‚ã‚Šã¾ã—ãŸã€‚\n\n`;

            let actions = [];
            if (document.getElementById('chkReceived').checked) actions.push("ãƒ»ãŠé›»è©±ãŒã‚ã£ãŸæ—¨ã€ãŠä¼ãˆã—ã¾ã™ã€‚");
            if (document.getElementById('chkCallback').checked) {
                const tel = document.getElementById('iptTel').value;
                let line = "ãƒ»æŠ˜ã‚Šè¿”ã—ãŠé›»è©±ã‚’ã„ãŸã ããŸã„ã¨ã®ã“ã¨ã§ã™ã€‚";
                if(tel) line += `\n  (é€£çµ¡å…ˆ: ${tel})`;
                actions.push(line);
            }
            if (document.getElementById('chkAgain').checked) {
                const time = document.getElementById('iptTime').value;
                let line = "ãƒ»ã¾ãŸæ”¹ã‚ã¾ã™ã¨ã®ã“ã¨ã§ã™ã€‚";
                if(time) line += `\n  (ç›®å®‰: ${time})`;
                actions.push(line);
            }

            if (actions.length > 0) {
                text += actions.join("\n\n");
                text += `\n\n`;
            }

            if (msg.trim() !== "") {
                text += `ã€ä¼è¨€ãƒ»è©³ç´°ã€‘\n${msg}\n\n`;
            } else if (actions.length === 0) {
                text += `(ç”¨ä»¶ã®å…¥åŠ›ã‚’ãŠå¾…ã¡ã—ã¦ã„ã¾ã™)\n\n`;
            }
            
            text += `--------------------------------\n`;
            text += `å—é›»: ${me}`;

            document.getElementById('resultText').innerText = text;
        }

        function copyToClipboard() {
            const text = document.getElementById('resultText').innerText;
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.querySelector('.copy-btn');
                const original = btn.innerHTML;
                btn.innerHTML = "ã‚³ãƒ”ãƒ¼å®Œäº†ã ã‚ˆï¼ğŸ‘Œ";
                btn.style.background = "linear-gradient(45deg, #43a047, #66bb6a)";
                setTimeout(() => {
                    btn.innerHTML = original;
                    btn.style.background = "linear-gradient(45deg, #ff9eb5, #ff6b81)";
                }, 2000);
            });
        }

        function resetForm() {
            const me = document.getElementById('iptMe').value;
            document.querySelectorAll('input[type="text"], textarea').forEach(e => e.value = "");
            document.querySelectorAll('input[type="checkbox"]').forEach(e => e.checked = false);
            document.getElementById('iptMe').value = me;
            update();
        }
    </script>
</body>
</html>