<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</title>
    <style>
        body { font-family: sans-serif; background-color: #f4f4f4; padding: 20px; text-align: center; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h2 { margin-top: 0; color: #333; }
        p { color: #666; font-size: 14px; line-height: 1.6; }
        
        .btn-area { display: flex; flex-direction: column; gap: 20px; margin-top: 30px; }
        
        .box { border: 1px solid #ddd; padding: 20px; border-radius: 8px; background: #f9f9f9; }
        .box h3 { margin-top: 0; font-size: 16px; }

        button { padding: 12px 20px; font-size: 16px; font-weight: bold; border: none; border-radius: 4px; cursor: pointer; width: 100%; }
        
        .btn-download { background-color: #28a745; color: white; }
        .btn-download:hover { background-color: #218838; }
        
        .btn-upload { background-color: #007bff; color: white; margin-top: 10px; }
        .btn-upload:hover { background-color: #0069d9; }

        .back-link { display: block; margin-top: 30px; color: #666; text-decoration: none; }
    </style>
</head>
<body>

    <div class="container">
        <a href="index.html" class="back-link">â¬… ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</a>
        <h2>ãƒ‡ãƒ¼ã‚¿ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</h2>
        <p>
            ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã€Œä¼šç¤¾æƒ…å ±ã€ã€Œãƒãƒ³ã‚³ã€ã€Œå±¥æ­´ã€ãªã©ã®ãƒ‡ãƒ¼ã‚¿ã‚’<br>
            ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ãƒ»å¾©å…ƒã—ã¾ã™ã€‚<br>
            PCã®è²·ã„æ›¿ãˆã‚„ã€åˆ¥ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¸ç§»è¡Œã™ã‚‹éš›ã«ã”åˆ©ç”¨ãã ã•ã„ã€‚
        </p>

        <div class="btn-area">
            <!-- æ›¸ãå‡ºã—ã‚¨ãƒªã‚¢ -->
            <div class="box">
                <h3>ğŸ“¤ ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹ (æ›¸ãå‡ºã—)</h3>
                <p>ç¾åœ¨ã®è¨­å®šã‚’ãƒ•ã‚¡ã‚¤ãƒ« (backup.json) ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚</p>
                <button class="btn-download" onclick="exportData()">è¨­å®šã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜</button>
            </div>

            <!-- èª­ã¿è¾¼ã¿ã‚¨ãƒªã‚¢ -->
            <div class="box">
                <h3>ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã™ã‚‹ (èª­ã¿è¾¼ã¿)</h3>
                <p>ä¿å­˜ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ã€è¨­å®šã‚’ä¸Šæ›¸ãã—ã¾ã™ã€‚</p>
                <input type="file" id="fileInput" accept=".json" style="display:none" onchange="importData(this)">
                <button class="btn-upload" onclick="document.getElementById('fileInput').click()">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦å¾©å…ƒ</button>
            </div>
        </div>
    </div>

    <script>
        // ä¿å­˜ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ¼æ¥é ­è¾ï¼ˆã“ã‚Œä»¥å¤–ã®ã‚´ãƒŸãƒ‡ãƒ¼ã‚¿ã¯ä¿å­˜ã—ãªã„ï¼‰
        const PREFIX = "my_tool_";

        // 1. æ›¸ãå‡ºã—å‡¦ç†
        function exportData() {
            const data = {};
            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ä¸­ã‹ã‚‰ã€ã“ã®ãƒ„ãƒ¼ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã ã‘ã‚’é›†ã‚ã‚‹
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith(PREFIX)) {
                    data[key] = localStorage.getItem(key);
                }
            }

            if (Object.keys(data).length === 0) {
                alert("ä¿å­˜ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚");
                return;
            }

            // JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
            const jsonStr = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);

            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’ä½œã£ã¦ã‚¯ãƒªãƒƒã‚¯ã•ã›ã‚‹
            const a = document.createElement("a");
            a.href = url;
            const date = new Date().toISOString().slice(0,10).replace(/-/g,"");
            a.download = `shorui_tool_backup_${date}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // 2. èª­ã¿è¾¼ã¿å‡¦ç†
        function importData(input) {
            const file = input.files[0];
            if (!file) return;

            if (!confirm("ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ãã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\n(å…ƒã«æˆ»ã™ã“ã¨ã¯ã§ãã¾ã›ã‚“)")) {
                input.value = ""; // ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã¯ãƒªã‚»ãƒƒãƒˆ
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
                    Object.keys(data).forEach(key => {
                        if (key.startsWith(PREFIX)) {
                            localStorage.setItem(key, data[key]);
                        }
                    });

                    alert("å¾©å…ƒãŒå®Œäº†ã—ã¾ã—ãŸï¼\nãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ã«æˆ»ã‚Šã¾ã™ã€‚");
                    window.location.href = "index.html";

                } catch (err) {
                    alert("ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\næ­£ã—ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
                    console.error(err);
                }
            };
            reader.readAsText(file);
        }
    </script>
</body>
</html>