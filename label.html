<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂÆõÂêç„É©„Éô„É´Âç∞Âà∑ (12Èù¢)</title>
    <style>
        /* --- ÂÖ®‰ΩìË®≠ÂÆö --- */
        body {
            display: none;
            font-family: "Helvetica Neue", Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
            gap: 20px;
            justify-content: center;
            min-height: 100vh;
        }

        /* Â∑¶„Éë„Éç„É´ */
        .editor-pane {
            width: 380px;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            height: fit-content;
            max-height: 90vh;
            overflow-y: auto;
        }

        .back-btn {
            display: inline-block;
            padding: 5px 10px;
            text-decoration: none;
            border-radius: var(--btn-radius);
            font-size: 12px;
            margin-bottom: 15px;
        }

        /* Â∑ÆÂá∫‰∫∫Ë®≠ÂÆö„Ç®„É™„Ç¢ */
        .sender-box {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #c8e6c9;
            margin-bottom: 20px;
        }

        .sender-title {
            font-size: 13px;
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .sender-row {
            display: flex;
            gap: 5px;
            margin-bottom: 5px;
        }

        /* CSV„Ç®„É™„Ç¢ */
        .csv-box {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #bbdefb;
            margin-bottom: 20px;
        }

        .csv-title {
            font-size: 12px;
            font-weight: bold;
            color: #1565c0;
            margin-bottom: 5px;
        }

        .csv-note {
            font-size: 10px;
            color: #555;
            margin-top: 5px;
            line-height: 1.4;
        }

        /* „É©„Éô„É´ÂÖ•Âäõ„Ç®„É™„Ç¢ */
        .form-group {
            margin-bottom: 20px;
            border-bottom: 1px dashed #eee;
            padding-bottom: 10px;
        }

        .form-label-title {
            display: block;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
            background: #f9f9f9;
            padding: 2px 5px;
        }

        input[type="text"] {
            width: 100%;
            padding: 6px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 12px;
            margin-bottom: 4px;
        }

        .input-row {
            display: flex;
            gap: 5px;
        }

        button.mode-btn {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            cursor: pointer;
            border: 1px solid #ccc;
            background: #fff;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        button.mode-btn:hover {
            background: #eee;
        }

        button.print-btn {
            width: 100%;
            padding: 12px;
            background-color: #009688;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 15px;
        }

        /* „Éó„É¨„Éì„É•„Éº„Ç®„É™„Ç¢ */
        .preview-pane {
            flex-grow: 1;
            display: flex;
            justify-content: center;
        }

        #sheet {
            width: 210mm;
            height: 297mm;
            background: white;
            padding: 12mm;
            box-sizing: border-box;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: repeat(6, 1fr);
            gap: 0mm 5mm;
        }

        .label-cell {
            border: 1px dashed #eee;
            padding: 5mm;
            display: flex;
            flex-direction: column;
            justify-content: center;
            font-family: "Yu Mincho", "YuMincho", serif;
            position: relative;
        }

        .l-zip {
            font-size: 14px;
            margin-bottom: 3px;
            letter-spacing: 1px;
            font-family: Arial, sans-serif;
        }

        .l-addr {
            font-size: 12px;
            margin-bottom: 5px;
            line-height: 1.3;
            height: 32px;
            overflow: hidden;
        }

        .l-company {
            font-size: 13px;
            margin-bottom: 5px;
            height: 18px;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .l-name-area {
            margin-top: 2px;
        }

        .l-title {
            font-size: 10px;
            color: #333;
            margin-bottom: 2px;
        }

        .l-name {
            font-size: 18px;
            font-weight: bold;
        }

        .l-subject {
            position: absolute;
            bottom: 3mm;
            right: 5mm;
            font-size: 10px;
            color: #555;
            border: 1px solid #999;
            padding: 2px 6px;
            border-radius: 2px;
        }

        @media print {
            body {
                display: block !important;
                background: none;
                margin: 0;
                padding: 0;
            }

            .editor-pane {
                display: none;
            }

            .preview-pane {
                display: block;
            }

            #sheet {
                box-shadow: none;
                width: 100%;
                height: 100%;
                margin: 0;
                page-break-after: always;
                padding: 12mm;
            }

            .label-cell {
                border: none;
            }

            @page {
                margin: 0;
                size: A4;
            }
        }

        /* ‚òÖCOOL„É¢„Éº„ÉâÂØæÁ≠ñÔºö„É©„Éô„É´ÂÜÖ„ÅÆÊñáÂ≠ó„ÅØÈªíÂº∑Âà∂ */
        body.theme-dark #sheet {
            color: #000 !important;
        }

        body.theme-dark .label-cell {
            color: #000 !important;
            border-color: #eee !important;
        }

        body.theme-dark .l-title {
            color: #333 !important;
        }

        body.theme-dark .l-subject {
            color: #555 !important;
            border-color: #999 !important;
        }
    </style>
    <link rel="stylesheet" href="theme.css">
</head>

<body>
    <script src="lock.js"></script>
    <script src="settings.js"></script>
    <script>if (typeof checkAuth === 'function') checkAuth(); else document.body.style.display = "flex";</script>

    <div class="editor-pane">
        <a href="index.html" class="back-btn">‚¨Ö „É°„Éã„É•„Éº„Å´Êàª„Çã</a>
        <h2>ÂÆõÂêç„É©„Éô„É´ (12Èù¢)</h2>

        <!-- ‚ñº Â∑ÆÂá∫‰∫∫Ë®≠ÂÆö -->
        <div class="sender-box">
            <div class="sender-title">üè¢ Â∑ÆÂá∫‰∫∫„ÉªËøî‰ø°Ë®≠ÂÆö</div>
            <p style="font-size:10px; margin:0 0 5px 0;">„Åì„Åì„ÅßÁ∑®ÈõÜ„Åó„Å¶„Éú„Çø„É≥„ÇíÊäº„Åô„Å®„ÄÅÂÖ®„Å¶„ÅÆ„É©„Éô„É´„Å´ÂèçÊò†„Åï„Çå„Åæ„Åô„ÄÇ</p>
            <div class="input-row">
                <input type="text" id="sendZip" placeholder="„Äí" aria-label="Â∑ÆÂá∫‰∫∫ÈÉµ‰æøÁï™Âè∑" onblur="toHalfWidth(this)"
                    style="width:30%;">
                <input type="text" id="sendAddr" placeholder="‰ΩèÊâÄ" aria-label="Â∑ÆÂá∫‰∫∫‰ΩèÊâÄ">
            </div>
            <input type="text" id="sendName" placeholder="Ê∞èÂêç / ‰ºöÁ§æÂêç" aria-label="Â∑ÆÂá∫‰∫∫Ê∞èÂêç">
            <div class="input-row" style="align-items:center;">
                <label style="font-size:11px;" for="sendSuffix">Êï¨Áß∞:</label>
                <input type="text" id="sendSuffix" value="ÂÆõ" style="width:50px; text-align:center;">
                <button class="mode-btn" onclick="applySenderToAll()"
                    style="margin-top:0; flex:1; background:#2e7d32; color:white; border:none;">ÂÖ®„É©„Éô„É´„Å´ÂèçÊò†</button>
            </div>
        </div>

        <!-- ‚ñº CSVÂèñ„ÇäËæº„Åø -->
        <div class="csv-box">
            <div class="csv-title">üìÇ CSV„Éï„Ç°„Ç§„É´„Åã„ÇâÂèñ„ÇäËæº„Åø</div>
            <input type="file" id="csvFile" accept=".csv" aria-label="CSV„Éï„Ç°„Ç§„É´ÈÅ∏Êäû" style="font-size:11px; width:100%;">
            <button class="mode-btn" onclick="loadCSV()" style="color:#1565c0; border-color:#1565c0;">Ë™≠„ÅøËæº„ÇÄ</button>
            <div class="csv-note">
                [A:„Äí] [B:‰ΩèÊâÄ] [C:‰ºöÁ§æÂêç] [D:ÂΩπËÅ∑] [E:Ê∞èÂêç] [F:‰ª∂Âêç]
            </div>
        </div>

        <button class="mode-btn" onclick="clearAll()" style="margin-bottom:15px;">üóëÔ∏è ÂÖ®„Å¶„ÇØ„É™„Ç¢</button>

        <div id="inputs-list">
            <!-- JS„Åß12ÂÄã„ÅÆÂÖ•ÂäõÊ¨Ñ„ÇíÁîüÊàê -->
        </div>

        <button class="print-btn" onclick="window.print()">üñ®Ô∏è Âç∞Âà∑„Åô„Çã</button>
    </div>

    <div class="preview-pane">
        <div id="sheet">
            <!-- JS„Åß12ÂÄã„ÅÆ„Çª„É´„ÇíÁîüÊàê -->
        </div>
    </div>

    <script>
        const LABEL_COUNT = 12;

        window.onload = function () {
            createInputs();
            if (typeof localStorage !== 'undefined') {
                const json = localStorage.getItem("my_tool_company_info");
                if (json) {
                    const data = JSON.parse(json);
                    document.getElementById('sendAddr').value = data.addr || "";
                    document.getElementById('sendName').value = data.name || "";
                }
            }
        };

        function toHalfWidth(elm) {
            let val = elm.value;
            val = val.replace(/[Ôºê-Ôºô]/g, function (s) {
                return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
            });
            val = val.replace(/[„Éº‚àí]/g, '-');
            elm.value = val;
        }

        function createInputs() {
            const inputList = document.getElementById('inputs-list');
            const sheet = document.getElementById('sheet');
            inputList.innerHTML = "";
            sheet.innerHTML = "";

            for (let i = 0; i < LABEL_COUNT; i++) {
                // ÂÖ•ÂäõÊ¨Ñ
                const div = document.createElement('div');
                div.className = 'form-group';
                div.innerHTML = `
                    <span class="form-label-title">„É©„Éô„É´ ${i + 1}</span>
                    <div class="input-row">
                        <input type="text" id="zip_${i}" placeholder="„Äí" aria-label="„É©„Éô„É´${i + 1} ÈÉµ‰æøÁï™Âè∑" onblur="toHalfWidth(this); update(${i})" oninput="update(${i})" style="width:30%;">
                        <input type="text" id="addr_${i}" placeholder="‰ΩèÊâÄ" aria-label="„É©„Éô„É´${i + 1} ‰ΩèÊâÄ" oninput="update(${i})">
                    </div>
                    <input type="text" id="comp_${i}" placeholder="‰ºöÁ§æÂêç" aria-label="„É©„Éô„É´${i + 1} ‰ºöÁ§æÂêç" oninput="update(${i})">
                    <div class="input-row">
                        <input type="text" id="post_${i}" placeholder="ÂΩπËÅ∑" aria-label="„É©„Éô„É´${i + 1} ÂΩπËÅ∑" oninput="update(${i})" style="width:40%;">
                        <input type="text" id="name_${i}" placeholder="Ê∞èÂêç" aria-label="„É©„Éô„É´${i + 1} Ê∞èÂêç" oninput="update(${i})">
                    </div>
                    <input type="text" id="subj_${i}" placeholder="‰ª∂Âêç" aria-label="„É©„Éô„É´${i + 1} ‰ª∂Âêç" oninput="update(${i})">
                    <input type="hidden" id="suffix_${i}" value="">
                `;
                inputList.appendChild(div);

                // „Éó„É¨„Éì„É•„Éº
                const cell = document.createElement('div');
                cell.className = 'label-cell';
                cell.id = `cell_${i}`;
                cell.innerHTML = `
                    <div class="l-zip" id="v_zip_${i}"></div>
                    <div class="l-addr" id="v_addr_${i}"></div>
                    <div class="l-company" id="v_comp_${i}"></div>
                    <div class="l-name-area">
                        <div class="l-title" id="v_post_${i}"></div>
                        <div class="l-name"><span id="v_name_${i}"></span> <span id="v_hon_${i}" style="font-size:14px;"></span></div>
                    </div>
                    <div class="l-subject" id="v_subj_${i}" style="display:none;"></div>
                `;
                sheet.appendChild(cell);
            }
        }

        function update(i) {
            document.getElementById(`v_zip_${i}`).innerText = document.getElementById(`zip_${i}`).value;
            document.getElementById(`v_addr_${i}`).innerText = document.getElementById(`addr_${i}`).value;
            document.getElementById(`v_comp_${i}`).innerText = document.getElementById(`comp_${i}`).value;
            document.getElementById(`v_post_${i}`).innerText = document.getElementById(`post_${i}`).value;

            const name = document.getElementById(`name_${i}`).value;
            const comp = document.getElementById(`comp_${i}`).value;
            document.getElementById(`v_name_${i}`).innerText = name;

            const forcedSuffix = document.getElementById(`suffix_${i}`).value;
            const honEl = document.getElementById(`v_hon_${i}`);

            if (forcedSuffix) {
                honEl.innerText = forcedSuffix;
            } else if (name) {
                honEl.innerText = "Êßò";
            } else if (comp) {
                honEl.innerText = "Âæ°‰∏≠";
            } else {
                honEl.innerText = "";
            }

            const subj = document.getElementById(`subj_${i}`).value;
            const subjEl = document.getElementById(`v_subj_${i}`);
            if (subj) {
                subjEl.innerText = subj;
                subjEl.style.display = "block";
            } else {
                subjEl.style.display = "none";
            }
        }

        function applySenderToAll() {
            const zip = document.getElementById('sendZip').value;
            const zipHalf = zip.replace(/[Ôºê-Ôºô]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0)).replace(/[„Éº‚àí]/g, '-');

            const addr = document.getElementById('sendAddr').value;
            const name = document.getElementById('sendName').value;
            const suffix = document.getElementById('sendSuffix').value;

            for (let i = 0; i < LABEL_COUNT; i++) {
                document.getElementById(`zip_${i}`).value = zipHalf;
                document.getElementById(`addr_${i}`).value = addr;
                document.getElementById(`comp_${i}`).value = "";
                document.getElementById(`post_${i}`).value = "";
                document.getElementById(`name_${i}`).value = name;
                document.getElementById(`subj_${i}`).value = "";

                document.getElementById(`suffix_${i}`).value = suffix;
                update(i);
            }
        }

        function loadCSV() {
            const fileInput = document.getElementById('csvFile');
            const file = fileInput.files[0];
            if (!file) { alert("CSV„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"); return; }

            const reader = new FileReader();
            reader.readAsText(file, 'Shift_JIS');

            reader.onload = function (e) {
                const text = e.target.result;
                const rows = text.split(/\r\n|\n/);

                let count = 0;
                for (let i = 0; i < rows.length; i++) {
                    if (count >= LABEL_COUNT) break;
                    const row = rows[i];
                    if (!row) continue;

                    const cols = row.split(',').map(c => c.replace(/^"|"$/g, ''));
                    if (cols.length < 2) continue;

                    let z = cols[0] || "";
                    z = z.replace(/[Ôºê-Ôºô]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0)).replace(/[„Éº‚àí]/g, '-');

                    document.getElementById(`zip_${count}`).value = z;
                    document.getElementById(`addr_${count}`).value = cols[1] || "";
                    document.getElementById(`comp_${count}`).value = cols[2] || "";
                    document.getElementById(`post_${count}`).value = cols[3] || "";
                    document.getElementById(`name_${count}`).value = cols[4] || "";
                    document.getElementById(`subj_${count}`).value = cols[5] || "";
                    document.getElementById(`suffix_${count}`).value = "";

                    update(count);
                    count++;
                }
                fileInput.value = "";
                alert(`${count}‰ª∂ Âèñ„ÇäËæº„Åø„Åæ„Åó„Åü`);
            };
        }

        function clearAll() {
            for (let i = 0; i < LABEL_COUNT; i++) {
                document.getElementById(`zip_${i}`).value = "";
                document.getElementById(`addr_${i}`).value = "";
                document.getElementById(`comp_${i}`).value = "";
                document.getElementById(`post_${i}`).value = "";
                document.getElementById(`name_${i}`).value = "";
                document.getElementById(`subj_${i}`).value = "";
                document.getElementById(`suffix_${i}`).value = "";
                update(i);
            }
        }
    </script>
    <script src="theme.js"></script>
</body>

</html>