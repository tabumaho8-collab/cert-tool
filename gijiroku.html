<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼šè­°è­°äº‹éŒ²ä½œæˆ</title>
    <style>
        /* --- å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        body { display: none; font-family: "Helvetica Neue", Arial, sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; gap: 20px; justify-content: center; min-height: 100vh; }
        .editor-pane { width: 350px; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); height: fit-content; overflow-y: auto; max-height: 90vh; }
        .back-btn { display: inline-block; background-color: #6c757d; color: white; padding: 5px 10px; text-decoration: none; border-radius: 4px; font-size: 12px; margin-bottom: 15px; cursor: pointer; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 12px; font-weight: bold; margin-bottom: 5px; color: #555; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 8px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
        
        .add-btn { background: #6c757d; color: white; border: none; padding: 2px 8px; font-size: 12px; cursor: pointer; border-radius: 4px; margin-left: 5px; }
        button.print-btn { width: 100%; padding: 12px; background-color: #007bff; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        
        .preview-pane { flex-grow: 1; display: flex; justify-content: center; }
        #doc { width: 210mm; min-height: 297mm; background: white; padding: 20mm; box-sizing: border-box; box-shadow: 0 5px 15px rgba(0,0,0,0.2); position: relative; color: #333; line-height: 1.6; }
        
        /* è­°äº‹éŒ²ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .g-title { text-align: center; font-size: 24px; font-weight: bold; margin-bottom: 20px; border: 2px solid #333; padding: 10px; }
        
        .g-meta-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 14px; }
        .g-meta-table th, .g-meta-table td { border: 1px solid #333; padding: 8px; }
        .g-meta-table th { background: #eee; width: 100px; text-align: left; font-weight: normal; }
        
        .g-section-title { font-size: 16px; font-weight: bold; border-left: 5px solid #007bff; padding-left: 10px; margin: 20px 0 10px 0; background: #f9f9f9; padding-top:5px; padding-bottom:5px; }
        
        .g-list { list-style: none; padding: 0; margin: 0; }
        .g-list li { margin-bottom: 8px; border-bottom: 1px dashed #ddd; padding-bottom: 5px; display: flex; }
        .g-list li::before { content: "â—"; color: #007bff; margin-right: 10px; }
        
        .todo-table { width: 100%; border-collapse: collapse; font-size: 14px; margin-top: 10px; }
        .todo-table th, .todo-table td { border: 1px solid #333; padding: 8px; }
        .todo-table th { background: #eee; font-weight: normal; }
        
        /* å…¥åŠ›ç”¨ãƒªã‚¹ãƒˆ */
        .input-list-item { display: flex; gap: 5px; margin-bottom: 5px; }
        .input-list-item input { flex: 1; }
        
        @media print { 
            body { display: block !important; background: none; margin: 0; padding: 0; } 
            .editor-pane { display: none; } 
            .preview-pane { display: block; } 
            #doc { box-shadow: none; width: 100%; height: 100%; margin: 0; padding: 20mm; page-break-after: always; } 
            @page { margin: 0; size: A4 portrait; } 
        }
    </style>
</head>
<body>
    <script src="auth.js"></script>
    <script src="settings.js"></script>
    <script>
        if (typeof checkAuth === 'function') checkAuth(); else document.body.style.display = "flex";
        window.addEventListener('load', function() {
            document.getElementById('iptDate').valueAsDate = new Date();
            addTopic(); addTodo();
            update();
        });
    </script>

    <div class="editor-pane">
        <a href="index.html" class="back-btn">â¬… ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</a>
        <h2>è­°äº‹éŒ² ä½œæˆ</h2>
        <div class="form-group"><label>ä¼šè­°å</label><input type="text" id="iptTitle" placeholder="ã€‡ã€‡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®šä¾‹ä¼š" oninput="update()"></div>
        <div class="form-group"><label>æ—¥æ™‚</label><input type="date" id="iptDate" oninput="update()"></div>
        <div class="form-group"><label>å ´æ‰€</label><input type="text" id="iptPlace" placeholder="ç¬¬1ä¼šè­°å®¤ / Zoom" oninput="update()"></div>
        <div class="form-group"><label>å‡ºå¸­è€…</label><textarea id="iptMember" rows="2" placeholder="å±±ç”°ã€éˆ´æœ¨ã€ä½è—¤..." oninput="update()"></textarea></div>
        
        <hr>
        <div class="form-group">
            <label>è­°é¡Œ / æ±ºå®šäº‹é … <button type="button" class="add-btn" onclick="addTopic()">ï¼‹è¡Œè¿½åŠ </button></label>
            <div id="topic-container"></div>
        </div>
        
        <hr>
        <div class="form-group">
            <label>æ¬¡å›ã¾ã§ã®ã‚¿ã‚¹ã‚¯ (ToDo) <button type="button" class="add-btn" onclick="addTodo()">ï¼‹è¡Œè¿½åŠ </button></label>
            <div id="todo-container"></div>
        </div>
        
        <hr>
        <div class="form-group"><label>æ¬¡å›äºˆå®š / å‚™è€ƒ</label><textarea id="iptNext" rows="2" oninput="update()"></textarea></div>

        <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ è­°äº‹éŒ²ã‚’å°åˆ·</button>
    </div>

    <div class="preview-pane">
        <div id="doc">
            <div class="g-title" id="viewTitle">ä¼šè­°è­°äº‹éŒ²</div>
            
            <table class="g-meta-table">
                <tr><th>æ—¥ã€€æ™‚</th><td id="viewDate"></td></tr>
                <tr><th>å ´ã€€æ‰€</th><td id="viewPlace"></td></tr>
                <tr><th>å‡ºå¸­è€…</th><td id="viewMember"></td></tr>
            </table>

            <div class="g-section-title">è­°é¡Œãƒ»æ±ºå®šäº‹é …</div>
            <ul class="g-list" id="viewTopicList"></ul>

            <div class="g-section-title">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ  (ToDo)</div>
            <table class="todo-table">
                <thead><tr><th style="width:70%;">ã‚¿ã‚¹ã‚¯å†…å®¹</th><th style="width:15%;">æ‹…å½“</th><th style="width:15%;">æœŸé™</th></tr></thead>
                <tbody id="viewTodoBody"></tbody>
            </table>

            <div class="g-section-title">æ¬¡å›äºˆå®šãƒ»å‚™è€ƒ</div>
            <div id="viewNext" style="white-space: pre-wrap; min-height: 50px;"></div>
        </div>
    </div>

    <script>
        function formatDate(dateStr) { if(!dateStr) return ""; const d = new Date(dateStr); return `${d.getFullYear()}å¹´${d.getMonth()+1}æœˆ${d.getDate()}æ—¥`; }

        function addTopic() {
            const div = document.createElement('div');
            div.className = 'input-list-item';
            div.innerHTML = `<textarea class="ipt-topic" rows="2" placeholder="å†…å®¹ã‚’å…¥åŠ›" oninput="update()" style="width:100%"></textarea>`;
            document.getElementById('topic-container').appendChild(div);
        }

        function addTodo() {
            const div = document.createElement('div');
            div.className = 'input-list-item';
            div.innerHTML = `
                <input type="text" class="ipt-todo-task" placeholder="ã‚¿ã‚¹ã‚¯" oninput="update()" style="flex:3;">
                <input type="text" class="ipt-todo-who" placeholder="æ‹…å½“" oninput="update()" style="flex:1;">
                <input type="text" class="ipt-todo-due" placeholder="æœŸé™" oninput="update()" style="flex:1;">
            `;
            document.getElementById('todo-container').appendChild(div);
        }

        function update() {
            document.getElementById('viewTitle').innerText = document.getElementById('iptTitle').value || "ä¼šè­°è­°äº‹éŒ²";
            document.getElementById('viewDate').innerText = formatDate(document.getElementById('iptDate').value);
            document.getElementById('viewPlace').innerText = document.getElementById('iptPlace').value;
            document.getElementById('viewMember').innerText = document.getElementById('iptMember').value;
            document.getElementById('viewNext').innerText = document.getElementById('iptNext').value;

            // è­°é¡Œãƒªã‚¹ãƒˆæ›´æ–°
            let topicHtml = '';
            document.querySelectorAll('.ipt-topic').forEach(el => {
                if(el.value.trim()) {
                    topicHtml += `<li><div style="white-space: pre-wrap;">${el.value}</div></li>`;
                }
            });
            document.getElementById('viewTopicList').innerHTML = topicHtml;

            // ToDoãƒªã‚¹ãƒˆæ›´æ–°
            let todoHtml = '';
            const tasks = document.querySelectorAll('.ipt-todo-task');
            const whos = document.querySelectorAll('.ipt-todo-who');
            const dues = document.querySelectorAll('.ipt-todo-due');
            
            tasks.forEach((el, i) => {
                if(el.value.trim() || whos[i].value.trim()) {
                    todoHtml += `<tr><td>${el.value}</td><td style="text-align:center;">${whos[i].value}</td><td style="text-align:center;">${dues[i].value}</td></tr>`;
                }
            });
            document.getElementById('viewTodoBody').innerHTML = todoHtml;
        }
    </script>
</body>
</html>