<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAXé€ä»˜çŠ¶ãƒ„ãƒ¼ãƒ«</title>
    <style>
        body { display: none; font-family: "Helvetica Neue", Arial, sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; gap: 20px; justify-content: center; min-height: 100vh; }
        .editor-pane { width: 380px; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); height: fit-content; }
        .back-btn { display: inline-block; background-color: #6c757d; color: white; padding: 5px 10px; text-decoration: none; border-radius: 4px; font-size: 12px; margin-bottom: 15px; cursor: pointer; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 12px; font-weight: bold; margin-bottom: 5px; color: #555; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 8px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
        .check-group { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px; }
        .check-label { display: flex; align-items: center; font-size: 12px; cursor: pointer; }
        .check-label input { width: auto; margin-right: 5px; }
        
        .quick-btn-group { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 5px; }
        .quick-btn {
            background-color: #e2e6ea; border: 1px solid #ccc; border-radius: 4px;
            padding: 4px 8px; font-size: 11px; cursor: pointer; color: #333;
        }
        .quick-btn:hover { background-color: #dbe2e8; }
        .btn-clear { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }

        button.print-btn { width: 100%; padding: 12px; background-color: #333; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        
        .preview-pane { flex-grow: 1; display: flex; justify-content: center; }
        #fax { width: 210mm; min-height: 297mm; background: white; padding: 20mm; box-sizing: border-box; box-shadow: 0 5px 15px rgba(0,0,0,0.2); position: relative; font-family: "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif; color: #000; }
        
        .f-title { font-size: 48px; font-weight: 900; text-align: center; border: 4px solid #000; padding: 10px; margin-bottom: 30px; letter-spacing: 5px; }
        
        .f-info-bar { display: flex; justify-content: space-between; align-items: center; border: 2px solid #000; padding: 15px; margin-bottom: 30px; }
        .f-date { font-size: 16px; font-weight: bold; }
        .f-pages { font-size: 20px; font-weight: bold; }
        .f-pages span { font-size: 32px; }

        /* â–¼â–¼â–¼ ä¿®æ­£: ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´ â–¼â–¼â–¼ */
        .f-header { display: flex; justify-content: space-between; margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 20px; align-items: flex-start; }
        .f-to, .f-from { width: 48%; }
        
        .f-label { font-size: 14px; font-weight: bold; background: #000; color: #fff; padding: 2px 8px; display: inline-block; margin-bottom: 8px; }
        
        /* å·¦å³ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’çµ±ä¸€ã™ã‚‹ã‚¯ãƒ©ã‚¹ */
        .f-main-text {
            font-size: 22px; /* å·¦å³åŒã˜ã‚µã‚¤ã‚º */
            font-weight: bold;
            line-height: 1.4;
            white-space: pre-wrap;
            padding-left: 2px;
        }
        
        /* Fromå´ã®ä½æ‰€ã‚„æ‹…å½“è€…ã¯å°‘ã—å°ã•ãã—ã¦ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹ */
        .f-sub-text {
            font-size: 14px;
            font-weight: normal;
            margin-top: 5px;
            line-height: 1.4;
        }
        /* â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–² */

        .f-checks { display: flex; gap: 20px; justify-content: center; margin-bottom: 30px; font-size: 16px; font-weight: bold; }
        .f-box { border: 2px solid #000; width: 20px; height: 20px; display: inline-block; vertical-align: middle; margin-right: 5px; text-align: center; line-height: 18px;}
        .f-subject { font-size: 20px; font-weight: bold; border-bottom: 1px solid #000; padding-bottom: 5px; margin-bottom: 20px; }
        .f-body { font-size: 16px; line-height: 1.8; white-space: pre-wrap; }

        @media print { body { display: block !important; background: none; margin: 0; padding: 0; } .editor-pane { display: none; } .preview-pane { display: block; } #fax { box-shadow: none; width: 100%; height: 100%; margin: 0; padding: 20mm; page-break-after: always; } @page { margin: 0; size: A4 portrait; } }
    </style>
</head>
<body>
    <script src="lock.js"></script>
    <script src="settings.js"></script>
    <script>
        if (typeof checkAuth === 'function') checkAuth(); else document.body.style.display = "flex";
        window.addEventListener('load', function() {
            if (typeof applyCompanyData === 'function') applyCompanyData();
            update();
        });
    </script>

    <div class="editor-pane">
        <a href="index.html" class="back-btn">â¬… ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</a>
        <h2>FAXé€ä»˜çŠ¶</h2>
        
        <div class="form-group"><label>æ—¥ä»˜</label><input type="date" id="iptDate" oninput="update()"></div>
        <div class="form-group"><label>é€ä¿¡æšæ•° (æœ¬ç´™å«ã‚€)</label><input type="number" id="iptPages" value="1" oninput="update()"></div>
        <hr>
        <div class="form-group"><label>é€ä¿¡å…ˆ (To)</label><textarea id="iptTo" rows="3" placeholder="ã€‡ã€‡æ ªå¼ä¼šç¤¾&#13;å–¶æ¥­éƒ¨ ç”°ä¸­ æ§˜" oninput="update()"></textarea></div>
        <div class="form-group"><label>ç™ºä¿¡å…ƒ (From)</label><textarea id="iptFrom" rows="3" oninput="update()"></textarea></div>
        <hr>
        <label>é€£çµ¡äº‹é …</label>
        <div class="check-group">
            <label class="check-label"><input type="checkbox" id="chk1" onchange="update()"> è‡³æ€¥</label>
            <label class="check-label"><input type="checkbox" id="chk2" onchange="update()"> å‚è€ƒ</label>
            <label class="check-label"><input type="checkbox" id="chk3" onchange="update()"> è¿”ä¿¡ã—ã¦ãã ã•ã„</label>
            <label class="check-label"><input type="checkbox" id="chk4" onchange="update()"> è¿”ä¿¡ä¸è¦</label>
        </div>
        
        <div class="form-group"><label>ä»¶å</label><input type="text" id="iptSubject" placeholder="ãŠè¦‹ç©ã‚Šã®ä»¶" oninput="update()"></div>
        
        <div class="form-group">
            <label>æœ¬æ–‡</label>
            <div class="quick-btn-group">
                <button type="button" class="quick-btn" onclick="addText('ã„ã¤ã‚‚ãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚')">æŒ¨æ‹¶</button>
                <button type="button" class="quick-btn" onclick="addText('è‡³æ€¥ã€ã”ç¢ºèªã‚’ãŠé¡˜ã„è‡´ã—ã¾ã™ã€‚')">è‡³æ€¥ç¢ºèª</button>
                <button type="button" class="quick-btn" onclick="addText('ã”æŸ»åã®ã»ã©ã€ã‚ˆã‚ã—ããŠé¡˜ã„è‡´ã—ã¾ã™ã€‚')">ã”æŸ»å</button>
                <button type="button" class="quick-btn" onclick="addText('æŠ˜ã‚Šè¿”ã—ãŠé›»è©±ã‚’ã„ãŸã ã‘ã¾ã™ã§ã—ã‚‡ã†ã‹ã€‚')">é›»è©±æ±‚ã‚€</button>
                <button type="button" class="quick-btn" onclick="addText('åŸæœ¬ã¯åˆ¥é€”éƒµé€ã„ãŸã—ã¾ã—ãŸã€‚')">åŸæœ¬éƒµé€</button>
                <button type="button" class="quick-btn btn-clear" onclick="clearText()">ã‚¯ãƒªã‚¢</button>
            </div>
            <textarea id="iptBody" rows="5" placeholder="ã„ã¤ã‚‚ãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™..." oninput="update()"></textarea>
        </div>

        <h3>å·®å‡ºäººæƒ…å ± (è‡ªå‹•)</h3>
        <div class="form-group"><label>ä¼šç¤¾å</label><input type="text" id="iptIssuerName" oninput="update()"></div>
        <div class="form-group"><label>TEL/FAXãªã©</label><textarea id="iptIssuerAddr" rows="3" oninput="update()"></textarea></div>
        <div class="form-group"><label>æ‹…å½“è€…ï¼ˆå½¹è·ãƒ»æ°åï¼‰</label><input type="text" id="iptIssuerRep" placeholder="å–¶æ¥­éƒ¨é•· å±±ç”° å¤ªéƒ" oninput="update()"></div>

        <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ FAXé€ä»˜çŠ¶ã‚’å°åˆ·</button>
    </div>

    <div class="preview-pane">
        <div id="fax">
            <div class="f-title">FAXé€ä»˜çŠ¶</div>
            
            <div class="f-info-bar">
                <div class="f-date">é€ä¿¡æ—¥ï¼š<span id="viewDate"></span></div>
                <div class="f-pages">é€ä¿¡æšæ•°ï¼š <span><span id="viewPages">1</span></span> æš (æœ¬ç´™å«ã‚€)</div>
            </div>

            <div class="f-header">
                <div class="f-to">
                    <span class="f-label">é€ä»˜å…ˆ (To)</span>
                    <!-- ä¿®æ­£: åŒã˜ã‚¯ãƒ©ã‚¹ã‚’é©ç”¨ -->
                    <div class="f-main-text" id="viewTo"></div>
                </div>
                <div class="f-from">
                    <span class="f-label">ç™ºä¿¡å…ƒ (From)</span>
                    <div class="f-content">
                        <!-- ä¿®æ­£: åŒã˜ã‚¯ãƒ©ã‚¹ã‚’é©ç”¨ -->
                        <div class="f-main-text" id="viewFromName"></div>
                        <!-- ä½æ‰€ãªã©ã¯å°‘ã—å°ã•ã -->
                        <div class="f-sub-text">
                            <div style="white-space: pre-wrap;" id="viewFromAddr"></div>
                            <div style="margin-top:5px;"><span id="viewFromRep"></span></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="f-checks">
                <span id="vChk1">â–¡ è‡³æ€¥</span>
                <span id="vChk2">â–¡ å‚è€ƒ</span>
                <span id="vChk3">â–¡ è¿”ä¿¡ã—ã¦ãã ã•ã„</span>
                <span id="vChk4">â–¡ è¿”ä¿¡ä¸è¦</span>
            </div>

            <div class="f-subject">ä»¶åï¼š<span id="viewSubject"></span></div>
            <div class="f-body" id="viewBody"></div>
        </div>
    </div>

    <script>
        window.onload = function() {
            document.getElementById('iptDate').valueAsDate = new Date();
            if (typeof applyCompanyData === 'function') applyCompanyData();
            update();
        };

        function addText(text) {
            const textarea = document.getElementById('iptBody');
            if (textarea.value) textarea.value += "\n" + text; else textarea.value = text;
            update();
        }

        function clearText() {
            if(confirm("æœ¬æ–‡ã‚’ã™ã¹ã¦æ¶ˆå»ã—ã¾ã™ã‹ï¼Ÿ")) {
                document.getElementById('iptBody').value = "";
                update();
            }
        }

        function formatDate(dateStr) { if(!dateStr) return ""; const d = new Date(dateStr); return `${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()}`; }

        function update() {
            document.getElementById('viewDate').innerText = formatDate(document.getElementById('iptDate').value);
            document.getElementById('viewPages').innerText = document.getElementById('iptPages').value;
            document.getElementById('viewTo').innerText = document.getElementById('iptTo').value;
            
            const comp = document.getElementById('iptIssuerName').value;
            const manualFrom = document.getElementById('iptFrom').value;
            
            if(manualFrom) {
                 document.getElementById('viewFromName').innerText = manualFrom;
                 document.getElementById('viewFromAddr').innerText = "";
                 document.getElementById('viewFromRep').innerText = "";
            } else {
                 document.getElementById('viewFromName').innerText = comp;
                 document.getElementById('viewFromAddr').innerText = document.getElementById('iptIssuerAddr').value;
                 document.getElementById('viewFromRep').innerText = document.getElementById('iptIssuerRep').value;
            }

            document.getElementById('viewSubject').innerText = document.getElementById('iptSubject').value;
            document.getElementById('viewBody').innerText = document.getElementById('iptBody').value;

            setCheck('chk1', 'vChk1', 'è‡³æ€¥');
            setCheck('chk2', 'vChk2', 'å‚è€ƒ');
            setCheck('chk3', 'vChk3', 'è¿”ä¿¡ã—ã¦ãã ã•ã„');
            setCheck('chk4', 'vChk4', 'è¿”ä¿¡ä¸è¦');
        }

        function setCheck(chkId, viewId, text) {
            const isChecked = document.getElementById(chkId).checked;
            document.getElementById(viewId).innerHTML = isChecked ? `<span style="font-size:20px;">â– </span> ${text}` : `â–¡ ${text}`;
        }
        
        document.querySelectorAll('input, textarea').forEach(i => i.addEventListener('input', update));
    </script>
</body>
</html>