<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¨Ÿè­°æ›¸ä½œæˆãƒ„ãƒ¼ãƒ«</title>
    <style>
        body { display: none; font-family: "Helvetica Neue", Arial, sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; gap: 20px; justify-content: center; min-height: 100vh; }
        .editor-pane { width: 380px; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); height: fit-content; overflow-y: auto; max-height: 90vh; }
        .back-btn { display: inline-block; background-color: #6c757d; color: white; padding: 5px 10px; text-decoration: none; border-radius: 4px; font-size: 12px; margin-bottom: 15px; cursor: pointer; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 12px; font-weight: bold; margin-bottom: 5px; color: #555; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 8px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
        button.print-btn { width: 100%; padding: 12px; background-color: #17a2b8; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .seal-switch { display: flex; align-items: center; gap: 5px; font-size: 12px; cursor: pointer; margin-top: 5px; }
        
        .preview-pane { flex-grow: 1; display: flex; justify-content: center; }
        #ringi { width: 210mm; min-height: 297mm; background: white; padding: 20mm; box-sizing: border-box; box-shadow: 0 5px 15px rgba(0,0,0,0.2); position: relative; font-family: "Yu Mincho", "YuMincho", serif; color: #333; }
        
        /* ç¨Ÿè­°æ›¸ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .r-title { text-align: center; font-size: 36px; font-weight: bold; letter-spacing: 10px; text-decoration: underline; margin-bottom: 30px; }
        .r-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        .r-info { font-size: 14px; line-height: 1.8; }
        
        /* ãƒãƒ³ã‚³æ ãƒ†ãƒ¼ãƒ–ãƒ« */
        .hanko-table { border-collapse: collapse; margin-left: auto; text-align: center; font-size: 12px; }
        .hanko-table th { border: 1px solid #333; padding: 2px 10px; background: #eee; width: 60px; font-weight: normal; }
        .hanko-table td { border: 1px solid #333; height: 60px; vertical-align: middle; position: relative; }
        
        .r-subject-box { border: 2px solid #333; padding: 10px; font-size: 18px; font-weight: bold; margin-bottom: 20px; text-align: center; background: #f9f9f9; }
        
        .r-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .r-table th, .r-table td { border: 1px solid #333; padding: 10px; vertical-align: top; }
        .r-table th { background: #eee; width: 80px; text-align: center; font-weight: normal; }
        .r-table td { min-height: 100px; }
        
        .r-content { white-space: pre-wrap; line-height: 1.6; min-height: 300px; }

        @media print { body { display: block !important; background: none; margin: 0; padding: 0; } .editor-pane { display: none; } .preview-pane { display: block; } #ringi { box-shadow: none; width: 100%; height: 100%; margin: 0; padding: 20mm; page-break-after: always; } @page { margin: 0; size: A4 portrait; } }
    </style>
</head>
<body>
    <script src="auth.js"></script>
    <script src="settings.js"></script>
    <script>
        if (typeof checkAuth === 'function') checkAuth(); else document.body.style.display = "flex";
        window.addEventListener('load', function() {
            if (typeof applyCompanyData === 'function') applyCompanyData();
            toggleSeal(); update();
        });
    </script>

    <div class="editor-pane">
        <a href="index.html" class="back-btn">â¬… ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</a>
        <h2>ç¨Ÿè­°æ›¸ ä½œæˆ</h2>
        
        <div class="form-group"><label>èµ·æ¡ˆæ—¥</label><input type="date" id="iptDate" oninput="update()"></div>
        <div class="form-group"><label>èµ·æ¡ˆç•ªå·</label><input type="text" id="iptNo" placeholder="ç¬¬ 2025-001 å·" oninput="update()"></div>
        <hr>
        <div class="form-group"><label>æ‰€å±éƒ¨ç½²</label><input type="text" id="iptDept" placeholder="å–¶æ¥­éƒ¨" oninput="update()"></div>
        <div class="form-group"><label>èµ·æ¡ˆè€…æ°å</label><input type="text" id="iptIssuerRep" oninput="update()"></div>
        <hr>
        <div class="form-group"><label>ä»¶å</label><input type="text" id="iptSubject" placeholder="æ–°è¦PCè³¼å…¥ã®ä»¶" oninput="update()"></div>
        <div class="form-group"><label>é‡‘é¡ (ã‚ã‚Œã°)</label><input type="text" id="iptAmount" placeholder="Â¥150,000-" oninput="update()"></div>
        <div class="form-group"><label>å®Ÿæ–½äºˆå®šæ—¥</label><input type="text" id="iptSchedule" placeholder="2025å¹´1æœˆé ƒ" oninput="update()"></div>
        <div class="form-group"><label>ç†ç”±ãƒ»è©³ç´°</label><textarea id="iptBody" rows="10" placeholder="ã€ç›®çš„ã€‘&#13;æ¥­å‹™åŠ¹ç‡åŒ–ã®ãŸã‚...&#13;&#13;ã€è©³ç´°ã€‘&#13;æ©Ÿç¨®ï¼šMacBook Air&#13;å°æ•°ï¼š1å°" oninput="update()"></textarea></div>
        
        <div class="form-group"><label class="seal-switch"><input type="checkbox" id="chkSeal" checked onchange="toggleSeal()"> èµ·æ¡ˆè€…å°(é›»å­)ã‚’è¡¨ç¤ºã™ã‚‹</label></div>
        <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ ç¨Ÿè­°æ›¸ã‚’å°åˆ·</button>
    </div>

    <div class="preview-pane">
        <div id="ringi">
            <div class="r-title">ç¨Ÿ è­° æ›¸</div>
            
            <div class="r-header">
                <div class="r-info">
                    èµ·æ¡ˆæ—¥ï¼š<span id="viewDate"></span><br>
                    æ‰€ã€€å±ï¼š<span id="viewDept"></span><br>
                    æ°ã€€åï¼š<span id="viewName"></span><br>
                    No.ï¼š<span id="viewNo"></span>
                </div>
                
                <!-- æ‰¿èªãƒ•ãƒ­ãƒ¼å°é‘‘æ  -->
                <table class="hanko-table">
                    <tr><th>æ±ºè£</th><th>æ‰¿èª</th><th>å¯©æŸ»</th><th>èµ·æ¡ˆ</th></tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td>
                            <!-- ã“ã“ã«é›»å­å°é‘‘ -->
                            <img id="viewSeal" src="" style="width:50px; height:50px; object-fit:contain; display:none; margin:auto;">
                            <div id="viewSealDummy" style="color:#ddd; font-size:10px;">(å°)</div>
                        </td>
                    </tr>
                </table>
            </div>

            <div class="r-subject-box">
                ä»¶åï¼š<span id="viewSubject"></span>
            </div>

            <table class="r-table">
                <tr>
                    <th>é‡‘é¡</th>
                    <td style="font-weight:bold; font-size:16px;"><span id="viewAmount"></span></td>
                </tr>
                <tr>
                    <th>äºˆå®šæ—¥</th>
                    <td><span id="viewSchedule"></span></td>
                </tr>
                <tr>
                    <th>ç†ç”±<br>è©³ç´°</th>
                    <td>
                        <div id="viewBody" class="r-content"></div>
                    </td>
                </tr>
                <tr>
                    <th>å‚™è€ƒ</th>
                    <td style="height:50px;"></td>
                </tr>
            </table>
            
            <div style="font-size:12px; text-align:right;">ä»¥ä¸Š</div>
        </div>
    </div>

    <script>
        window.onload = function() {
            document.getElementById('iptDate').valueAsDate = new Date();
            if (typeof applyCompanyData === 'function') applyCompanyData();
            toggleSeal(); update();
        };

        function toggleSeal() { 
            const isChecked = document.getElementById('chkSeal').checked; 
            const img = document.getElementById('viewSeal');
            const dummy = document.getElementById('viewSealDummy');
            if (img.src && img.src.length > 10 && isChecked) {
                img.style.display = 'block'; 
                dummy.style.display = 'none';
            } else {
                img.style.display = 'none';
                dummy.style.display = 'block';
            }
        }

        function formatDate(dateStr) { if(!dateStr) return ""; const d = new Date(dateStr); return `${d.getFullYear()}å¹´${d.getMonth()+1}æœˆ${d.getDate()}æ—¥`; }

        function update() {
            document.getElementById('viewDate').innerText = formatDate(document.getElementById('iptDate').value);
            document.getElementById('viewNo').innerText = document.getElementById('iptNo').value;
            document.getElementById('viewDept').innerText = document.getElementById('iptDept').value;
            document.getElementById('viewName').innerText = document.getElementById('iptIssuerRep').value; // settings.jsã®æ‹…å½“è€…ã‚’æ°åæ¬„ã¸
            document.getElementById('viewSubject').innerText = document.getElementById('iptSubject').value;
            document.getElementById('viewAmount').innerText = document.getElementById('iptAmount').value;
            document.getElementById('viewSchedule').innerText = document.getElementById('iptSchedule').value;
            document.getElementById('viewBody').innerText = document.getElementById('iptBody').value;
        }
        
        document.querySelectorAll('input, textarea').forEach(i => i.addEventListener('input', update));
    </script>
</body>
</html>